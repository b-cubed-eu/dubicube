<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Group-Level Sensitivity Analysis • dubicube</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/PT_Sans-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Group-Level Sensitivity Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dubicube</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Tutorials</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../CONTRIBUTING.html">Contributing</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://b-cubed.eu/" aria-label="B-Cubed website"><span class="fa fa-cube"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/b-cubed-eu/dubicube/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Group-Level Sensitivity Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/b-cubed-eu/dubicube/blob/main/vignettes/articles/group-level-sensitivity.Rmd" class="external-link"><code>vignettes/articles/group-level-sensitivity.Rmd</code></a></small>
      <div class="d-none name"><code>group-level-sensitivity.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>When working with biodiversity data cubes, understanding how
sensitive your indicators are to individual groups (like species, sites,
or time periods) can be crucial for robust analysis. This tutorial
introduces the <code><a href="../reference/cross_validate_cube.html">cross_validate_cube()</a></code> function from
<strong>dubicube</strong>, which helps assess how individual categories
influence biodiversity indicators using cross-validation.</p>
</div>
<div class="section level2">
<h2 id="group-level-cross-validation-for-data-cubes">Group-level cross-validation for data cubes<a class="anchor" aria-label="anchor" href="#group-level-cross-validation-for-data-cubes"></a>
</h2>
<p>Cross-validation is a resampling technique commonly used in
statistics and machine learning to evaluate model performance. In the
context of biodiversity data cubes, we adapt cross-validation to assess
how robust indicators are to the inclusion or exclusion of specific
groups. This helps identify influential categories that
disproportionately affect indicator values.</p>
<div class="section level3">
<h3 id="a-data-cube-and-a-statistic">A data cube and a statistic<a class="anchor" aria-label="anchor" href="#a-data-cube-and-a-statistic"></a>
</h3>
<p>Consider a data cube <span class="math inline">\(\mathbf{X}\)</span>
from which we want to calculate a statistic <span class="math inline">\(\theta\)</span>. The data cube can be grouped,
e.g. by <code>taxon</code>, that contains multiple categories,
e.g. <code>species1</code>, <code>species2</code>, <code>species3</code>
…</p>
<ul>
<li>
<strong>Original Sample Data</strong>: <span class="math inline">\(\mathbf{X} = \{X_{11}, X_{12}, X_{13}, \ldots,
X_{sn}\}\)</span>
<ul>
<li>The initial set of data points, where there are <span class="math inline">\(s\)</span> different categories in a group
(e.g. <span class="math inline">\(s = 10\)</span> species in group
<code>taxon</code>) and <span class="math inline">\(n\)</span> total
samples across all categories (= the sample size). <span class="math inline">\(n\)</span> corresponds to the number of cells in a
data cube or the number of rows in tabular format.</li>
</ul>
</li>
<li>
<strong>Statistic of Interest</strong>: <span class="math inline">\(\theta\)</span>
<ul>
<li>The parameter or statistic being estimated, such as the mean <span class="math inline">\(\bar{X}\)</span>, variance <span class="math inline">\(\sigma^2\)</span>, or a biodiversity indicator.
Let <span class="math inline">\(\hat{\theta}\)</span> denote the
estimated value of <span class="math inline">\(\theta\)</span>
calculated from the complete dataset <span class="math inline">\(\mathbf{X}\)</span>.</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="resampling-and-recalculating">Resampling and recalculating<a class="anchor" aria-label="anchor" href="#resampling-and-recalculating"></a>
</h3>
<p>From <span class="math inline">\(\mathbf{X}\)</span>, multiple data
cubes <span class="math inline">\(\mathbf{X}_{-s_j}\)</span> are created
where in each new dataset a different category is removed compared to
the original data cube <span class="math inline">\(\mathbf{X}\)</span>.
For example in dataset 1, <code>species1</code> is excluded; in dataset
2 <code>species2</code>; in dataset 3 <code>species3</code>; and so on.
For each new dataset, the statistic <span class="math inline">\(\theta\)</span> is again calculated: <span class="math inline">\(\hat{\theta}_{-s_j}\)</span>.</p>
<ul>
<li>
<strong>Cross-Validation (CV) Sample</strong>: <span class="math inline">\(\mathbf{X}_{-s_j}\)</span>
<ul>
<li>The full dataset <span class="math inline">\(\mathbf{X}\)</span>
excluding all samples belonging to category <span class="math inline">\(j\)</span>. This subset is used to investigate the
influence of category <span class="math inline">\(j\)</span> on the
estimated statistic <span class="math inline">\(\hat{\theta}\)</span>.</li>
</ul>
</li>
<li>
<strong>CV Estimate for Category</strong> <span class="math inline">\(\mathbf{j}\)</span>: <span class="math inline">\(\hat{\theta}_{-s_j}\)</span>
<ul>
<li>The value of the statistic of interest calculated from <span class="math inline">\(\mathbf{X}_{-s_j}\)</span>, which excludes
category <span class="math inline">\(j\)</span>. For example, if <span class="math inline">\(\theta\)</span> is the sample mean, <span class="math inline">\(\hat{\theta}_{-s_j} =
\bar{X}_{-s_j}\)</span>.</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="derivation-of-error-measures">Derivation of error measures<a class="anchor" aria-label="anchor" href="#derivation-of-error-measures"></a>
</h3>
<p>From this, we can calculate different error measures that help inform
further analyses or decision-making steps.</p>
<ul>
<li>
<p><strong>Error Measures</strong>:</p>
<ul>
<li>The <strong>Error</strong> is the difference between the statistic
estimated without category <span class="math inline">\(j\)</span> (<span class="math inline">\(\hat{\theta}_{-s_j}\)</span>) and the statistic
calculated on the complete dataset (<span class="math inline">\(\hat{\theta}\)</span>).</li>
</ul>
<p><span class="math display">\[
\text{Error}_{s_j} = \hat{\theta}_{-s_j} - \hat{\theta}
\]</span></p>
<ul>
<li>The <strong>Relative Error</strong> is the absolute error,
normalized by the true estimate <span class="math inline">\(\hat{\theta}\)</span> and a small error term <span class="math inline">\(\epsilon = 10^{-8}\)</span> to avoid division by
zero.</li>
</ul>
<p><span class="math display">\[
\text{Rel. Error}_{s_j} = \frac{|\hat{\theta}_{-s_j} -
\hat{\theta}|}{\hat{\theta} +\epsilon}
\]</span></p>
<ul>
<li>The <strong>Percent Error</strong> is the relative error expressed
as a percentage.</li>
</ul>
<p><span class="math display">\[
\text{Perc. Error}_{s_j} = \text{Rel. Error}_{s_j} \times 100 \%
\]</span></p>
</li>
<li>
<p><strong>Summary Measures</strong>:</p>
<ul>
<li>The <strong>Mean Relative Error (MRE)</strong> is the average of the
relative errors over all categories.</li>
</ul>
<p><span class="math display">\[
\text{MRE} = \frac{1}{s} \sum_{j=1}^s \text{Rel. Error}_{s_j}
\]</span></p>
<ul>
<li>The <strong>Mean Squared Error (MSE)</strong> is the average of the
squared errors.</li>
</ul>
<p><span class="math display">\[
\text{MSE} = \frac{1}{s} \sum_{j=1}^s (\text{Error}_{s_j})^2
\]</span></p>
<ul>
<li>The <strong>Root Mean Squared Error (RMSE)</strong> is the square
root of the MSE.</li>
</ul>
<p><span class="math display">\[
\text{RMSE} = \sqrt{\text{MSE}}
\]</span></p>
</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="getting-started-with-dubicube">Getting started with dubicube<a class="anchor" aria-label="anchor" href="#getting-started-with-dubicube"></a>
</h2>
<p>The <strong>dubicube</strong> cross-validation method can be applied
on any dataframe from which a statistic is calculated and for which a
grouping variable is present. For this tutorial, we focus on occurrence
cubes. Therefore, we will use the <strong>b3gbi</strong> package for
processing the raw data before moving on to the cross-validation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>      <span class="co"># Data visualisation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>        <span class="co"># Data wrangling</span></span>
<span></span>
<span><span class="co"># Data loading and processing</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/frictionlessdata/frictionless-r" class="external-link">frictionless</a></span><span class="op">)</span> <span class="co"># Load example datasets</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/b-cubed-eu/b3gbi" class="external-link">b3gbi</a></span><span class="op">)</span>        <span class="co"># Process occurrence cubes</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/b-cubed-eu/dubicube" class="external-link">dubicube</a></span><span class="op">)</span>     <span class="co"># Analysis of data quality &amp; reliability</span></span></code></pre></div>
<div class="section level3">
<h3 id="loading-and-processing-the-data">Loading and processing the data<a class="anchor" aria-label="anchor" href="#loading-and-processing-the-data"></a>
</h3>
<p>We load the bird cube data from the <strong>b3data</strong> data
package using <strong>frictionless</strong> (see also <a href="https://github.com/b-cubed-eu/b3data-scripts" class="external-link">here</a>). It is an
occurrence cube for birds in Belgium between 2000 en 2024 using the MGRS
grid at 10 km scale.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read data package</span></span>
<span><span class="va">b3data_package</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/frictionless/reference/read_package.html" class="external-link">read_package</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://zenodo.org/records/15211029/files/datapackage.json"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load bird cube data</span></span>
<span><span class="va">bird_cube_belgium</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/frictionless/reference/read_resource.html" class="external-link">read_resource</a></span><span class="op">(</span><span class="va">b3data_package</span>, <span class="st">"bird_cube_belgium_mgrs10"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bird_cube_belgium</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;    year mgrscode specieskey species          family     n mincoordinateuncerta…¹</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">473</span>958 Perdix perdix    Phasi…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">474</span>156 Coturnix coturn… Phasi…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">474</span>377 Fulica atra      Ralli…     5                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">475</span>443 Merops apiaster  Merop…     6                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">480</span>242 Vanellus vanell… Chara…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">480</span>637 Accipiter nisus  Accip…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​mincoordinateuncertaintyinmeters</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: familycount &lt;dbl&gt;</span></span></span></code></pre></div>
<p>We process the cube with <strong>b3gbi</strong> to put the data in a
format, ready for analysis. We select the data from 2011 - 2020.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">processed_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://b-cubed-eu.github.io/b3gbi/reference/process_cube.html" class="external-link">process_cube</a></span><span class="op">(</span></span>
<span>  <span class="va">bird_cube_belgium</span>,</span>
<span>  first_year <span class="op">=</span> <span class="fl">2011</span>,</span>
<span>  last_year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  cols_occurrences <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">processed_cube</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Processed data cube for calculating biodiversity indicators</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Date Range: 2011 - 2020 </span></span>
<span><span class="co">#&gt; Single-resolution cube with cell size 10km ^2 </span></span>
<span><span class="co">#&gt; Number of cells: 379 </span></span>
<span><span class="co">#&gt; Grid reference system: mgrs </span></span>
<span><span class="co">#&gt; Coordinate range:</span></span>
<span><span class="co">#&gt;    xmin    xmax    ymin    ymax </span></span>
<span><span class="co">#&gt;  280000  710000 5480000 5700000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total number of observations: 13225290 </span></span>
<span><span class="co">#&gt; Number of species represented: 646 </span></span>
<span><span class="co">#&gt; Number of families represented: 92 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Kingdoms represented: Data not present </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; First 10 rows of data (use n = to show more):</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 280,184 × 13</span></span></span>
<span><span class="co">#&gt;     year cellCode taxonKey scientificName    family   obs minCoordinateUncerta…¹</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>011 31UDS65   2<span style="text-decoration: underline;">474</span>051 Alectoris rufa    Phasi…     1                    100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>011 31UDS65   2<span style="text-decoration: underline;">474</span>377 Fulica atra       Ralli…     6                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>011 31UDS65   2<span style="text-decoration: underline;">474</span>831 Rallus aquaticus  Ralli…     1                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>011 31UDS65   2<span style="text-decoration: underline;">478</span>523 Picus viridis     Picid…     5                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>011 31UDS65   2<span style="text-decoration: underline;">480</span>242 Vanellus vanellus Chara…     4                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>011 31UDS65   2<span style="text-decoration: underline;">480</span>332 Pluvialis aprica… Chara…     1                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>011 31UDS65   2<span style="text-decoration: underline;">480</span>482 Circus aeruginos… Accip…     2                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>011 31UDS65   2<span style="text-decoration: underline;">480</span>487 Circus cyaneus    Accip…     9                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>011 31UDS65   2<span style="text-decoration: underline;">480</span>537 Buteo buteo       Accip…     8                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>011 31UDS65   2<span style="text-decoration: underline;">480</span>637 Accipiter nisus   Accip…     9                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 280,174 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​minCoordinateUncertaintyInMeters</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: familyCount &lt;dbl&gt;, xcoord &lt;dbl&gt;, ycoord &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   utmzone &lt;int&gt;, hemisphere &lt;chr&gt;, resolution &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="analysis-of-the-data">Analysis of the data<a class="anchor" aria-label="anchor" href="#analysis-of-the-data"></a>
</h3>
<p>Suppose we are interested in the average number of observations per
grid cell per year. We create the function <code>mean_obs()</code> to
calculate this.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to calculate the mean of observations per grid cell per year</span></span>
<span><span class="va">mean_obs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">obs</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>, .by <span class="op">=</span> <span class="st">"cellCode"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>diversity_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, .by <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We get the following results:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean_obs</span><span class="op">(</span><span class="va">processed_cube</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;    year diversity_val</span></span>
<span><span class="co">#&gt; 1  2011      48.83864</span></span>
<span><span class="co">#&gt; 2  2012      48.27942</span></span>
<span><span class="co">#&gt; 3  2013      48.13675</span></span>
<span><span class="co">#&gt; 4  2014      47.82226</span></span>
<span><span class="co">#&gt; 5  2015      47.39197</span></span>
<span><span class="co">#&gt; 6  2016      47.32866</span></span>
<span><span class="co">#&gt; 7  2017      46.31520</span></span>
<span><span class="co">#&gt; 8  2018      45.87515</span></span>
<span><span class="co">#&gt; 9  2019      45.93329</span></span>
<span><span class="co">#&gt; 10 2020      44.98668</span></span></code></pre></div>
<p>These values do not tell us anything about reliability on their own.
Therefore, we perform a leave-one-species-out cross-validation (LOSO-CV)
to investigate the impact of individual species being excluded from the
calculation.</p>
</div>
<div class="section level3">
<h3 id="leave-one-species-out-cross-validation">Leave-one-species-out cross-validation<a class="anchor" aria-label="anchor" href="#leave-one-species-out-cross-validation"></a>
</h3>
<p>We use the <code><a href="../reference/cross_validate_cube.html">cross_validate_cube()</a></code> function to do this. It
relies on the following arguments:</p>
<ul>
<li><p><strong><code>data_cube</code></strong>:<br>
The input data, either a processed data cube (from
<code><a href="https://b-cubed-eu.github.io/b3gbi/reference/process_cube.html" class="external-link">b3gbi::process_cube()</a></code>), or just the dataframe inside
(i.e. <code>processed_cube$data</code>). For faster computation, passing
just the dataframe is recommended.</p></li>
<li><p><strong><code>fun</code></strong>:<br>
A user-defined function that computes the statistic(s) of interest from
<code>data_cube</code>. This function should return a dataframe that
includes a column named <code>diversity_val</code>, containing the
statistic to evaluate.</p></li>
<li><p><strong><code>grouping_var</code></strong>:<br>
The column(s) used for grouping the output of <code>fun()</code>. For
example, if <code>fun()</code> returns one value per year, use
<code>grouping_var = "year"</code>.</p></li>
<li><p><strong><code>out_var</code></strong>:<br>
The variable used to leave out one group at a time during
cross-validation. The default is <code>"taxonKey"</code> (typically
representing species), which results in leave-one-species-out
cross-validation.</p></li>
<li><p><strong><code>progress</code></strong>:<br>
Logical flag to show a progress bar. Set to <code>TRUE</code> to enable
progress reporting; default is <code>FALSE</code>.</p></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross_validate_cube.html">cross_validate_cube</a></span><span class="op">(</span></span>
<span>  data_cube <span class="op">=</span> <span class="va">processed_cube</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">mean_obs</span>,</span>
<span>  grouping_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  out_var <span class="op">=</span> <span class="st">"taxonKey"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cv_results</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id_cv year taxonkey_out   rep_cv est_original       error     sq_error</span></span>
<span><span class="co">#&gt; 1     1 2011      2474051 48.85551     48.83864  0.01686866 0.0002845518</span></span>
<span><span class="co">#&gt; 2     2 2011      2474377 48.49272     48.83864 -0.34592150 0.1196616847</span></span>
<span><span class="co">#&gt; 3     3 2011      2474831 48.91447     48.83864  0.07583503 0.0057509524</span></span>
<span><span class="co">#&gt; 4     4 2011      2478523 48.66861     48.83864 -0.17002678 0.0289091060</span></span>
<span><span class="co">#&gt; 5     5 2011      2480242 48.56884     48.83864 -0.26979464 0.0727891466</span></span>
<span><span class="co">#&gt; 6     6 2011      2480332 48.97265     48.83864  0.13401280 0.0179594315</span></span>
<span><span class="co">#&gt;    abs_error    rel_error perc_error         mre        mse      rmse</span></span>
<span><span class="co">#&gt; 1 0.01686866 0.0003453959 0.03453959 0.001122516 0.03544285 0.1882627</span></span>
<span><span class="co">#&gt; 2 0.34592150 0.0070829473 0.70829473 0.001122516 0.03544285 0.1882627</span></span>
<span><span class="co">#&gt; 3 0.07583503 0.0015527672 0.15527672 0.001122516 0.03544285 0.1882627</span></span>
<span><span class="co">#&gt; 4 0.17002678 0.0034813989 0.34813989 0.001122516 0.03544285 0.1882627</span></span>
<span><span class="co">#&gt; 5 0.26979464 0.0055242048 0.55242048 0.001122516 0.03544285 0.1882627</span></span>
<span><span class="co">#&gt; 6 0.13401280 0.0027439914 0.27439914 0.001122516 0.03544285 0.1882627</span></span></code></pre></div>
<p>The RMSE is an average error measure we obtain for each year. It
remains very similar over the years.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualise mean errors</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cv_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Reference line</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, colour <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Plot RMSE</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">rmse</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Settings</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"RMSE"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="group-level-sensitivity_files/figure-html/unnamed-chunk-9-1.png" alt="RMSE for mean number of occurrences over time." width="700"></p>
<p>Indeed, looking at the individual error values reveals similar
patterns for every year. The species with taxon key 2481174 has an error
of -2 in year 2011. This means that without this species the average
number of occurrences per grid cell would be 2 units lower than the
estimate based on the full dataset (in this case around 46.8 instead of
48.8).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get original estimates (based on full data cube)</span></span>
<span><span class="va">original_estimates</span> <span class="op">&lt;-</span> <span class="fu">mean_obs</span><span class="op">(</span><span class="va">processed_cube</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">original_estimates</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>  <span class="st">"hat(theta) =="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">original_estimates</span><span class="op">$</span><span class="va">diversity_val</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualise errors</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cv_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Reference line</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, colour <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Plot species keys</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">error</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">taxonkey_out</span><span class="op">)</span>,</span>
<span>                label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">taxonkey_out</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Plot original estimates</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_label</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">original_estimates</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">label</span><span class="op">)</span>,</span>
<span>             y <span class="op">=</span> <span class="fl">0.9</span>, parse <span class="op">=</span> <span class="cn">TRUE</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Settings</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"LOSO-CV Error"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="group-level-sensitivity_files/figure-html/unnamed-chunk-10-1.png" alt="Species errors for mean number of occurrences over time." width="700"></p>
<p>There are two species that have a big effect on the calculation of
our statistic.</p>
<ul>
<li>2481174: <a href="https://www.gbif.org/species/2481174" class="external-link"><em>Larus
fuscus</em> Linnaeus, 1758</a>
</li>
<li>2481139: <a href="https://www.gbif.org/species/2481139" class="external-link"><em>Larus
argentatus</em> Pontoppidan, 1763</a>
</li>
</ul>
<p>If we go back to the source of the data, we see that the data cube
includes records from two large datasets strictly dedicated to these two
species (<a href="https://www.gbif.org/dataset/355b8ff9-7bd9-49c3-92af-f6741b8bd0cb" class="external-link">2481174</a>,
<a href="https://www.gbif.org/dataset/6c860eb3-83ba-48c3-9328-a7b3c7a3c7b4" class="external-link">2481139</a>).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="st">"bird_cube_belgium_mgrs10"</span>, <span class="fu"><a href="https://docs.ropensci.org/frictionless/reference/resources.html" class="external-link">resources</a></span><span class="op">(</span><span class="va">b3data_package</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">b3data_package</span><span class="op">$</span><span class="va">resources</span><span class="op">[[</span><span class="va">index</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sources</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [[1]]$title</span></span>
<span><span class="co">#&gt; [1] "GBIF Occurrence Download"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$path</span></span>
<span><span class="co">#&gt; [1] "https://doi.org/10.15468/dl.y3wpwk"</span></span></code></pre></div>
<p>This suggests that the two species are overrepresented in the data
cube, likely due to targeted monitoring efforts. Their disproportionate
influence inflates indicator values, potentially distorting the true
diversity signal. Group-level sensitivity analysis like this helps
uncover such sampling biases, ensuring that biodiversity indicators
reflect ecological reality rather than artifacts in the data.</p>
</div>
</div>
<div class="section level2">
<h2 id="advanced-usage-of-cross_validate_cube">Advanced usage of <code>cross_validate_cube()</code><a class="anchor" aria-label="anchor" href="#advanced-usage-of-cross_validate_cube"></a>
</h2>
<div class="section level3">
<h3 id="cross-validate-simple-dataframes">Cross-validate simple dataframes<a class="anchor" aria-label="anchor" href="#cross-validate-simple-dataframes"></a>
</h3>
<p>As stated in the documentation, it is also possible to cross-validate
over a dataframe. In this case, set the argument
<code>processed_cube = FALSE</code>. This is implemented allow for
flexible use of simple dataframes, while still encouraging the use of
<code><a href="https://b-cubed-eu.github.io/b3gbi/reference/process_cube.html" class="external-link">b3gbi::process_cube()</a></code> as default functionality.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv_results_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross_validate_cube.html">cross_validate_cube</a></span><span class="op">(</span></span>
<span>  data_cube <span class="op">=</span> <span class="va">processed_cube</span><span class="op">$</span><span class="va">data</span>,      <span class="co"># data.frame object</span></span>
<span>  fun <span class="op">=</span> <span class="va">mean_obs</span>,</span>
<span>  grouping_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  out_var <span class="op">=</span> <span class="st">"taxonKey"</span>,</span>
<span>  processed_cube <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="optional-arguments">Optional arguments<a class="anchor" aria-label="anchor" href="#optional-arguments"></a>
</h3>
<p>The <code><a href="../reference/cross_validate_cube.html">cross_validate_cube()</a></code> function includes several
optional parameters that give you more control over how the
cross-validation is performed. These arguments are not required for
basic use, but can be helpful in specific scenarios.</p>
<ul>
<li>
<p><strong>Cross-validation Method</strong>:
<code>crossv_method</code><br>
Determines how data is partitioned for cross-validation.</p>
<ul>
<li><p><code>"loo"</code> (default):<br>
Leave-one-out cross-validation. One category in <code>out_var</code>
(e.g. one species) is excluded at a time.</p></li>
<li><p><code>"kfold"</code>:<br>
K-fold cross-validation. All categories in <code>out_var</code> are
split into <code>k</code> subsets, and each subset is excluded once
while the others are used for analysis.<br><em>Note: this method is experimental and results should be interpreted
with caution.</em></p></li>
</ul>
</li>
<li><p><strong>Number of Folds</strong>: <code>k</code><br>
Specifies the number of folds when using <code>"kfold"</code>
cross-validation.<br>
Default is <code>5</code>. Only used when
<code>crossv_method = "kfold"</code>.</p></li>
<li><p><strong>Maximum Number of Categories</strong>:
<code>max_out_cats</code><br>
Sets an upper limit on the number of unique categories in
<code>out_var</code> that will be excluded one-by-one during
cross-validation.<br>
Default is <code>1000</code>. This helps to prevent long runtimes for
datasets with many unique categories. You can increase this if needed,
but expect slower computation.</p></li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ward Langeraert, Toon Van Daele, European Union.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
