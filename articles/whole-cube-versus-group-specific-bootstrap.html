<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Whole-cube Bootstrap versus Group-specific Bootstrap • dubicube</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/PT_Sans-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Whole-cube Bootstrap versus Group-specific Bootstrap">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dubicube</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Tutorials</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../CONTRIBUTING.html">Contributing</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://b-cubed.eu/" aria-label="B-Cubed website"><span class="fa fa-cube"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/b-cubed-eu/dubicube/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Whole-cube Bootstrap versus Group-specific Bootstrap</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/b-cubed-eu/dubicube/blob/main/vignettes/articles/whole-cube-versus-group-specific-bootstrap.Rmd" class="external-link"><code>vignettes/articles/whole-cube-versus-group-specific-bootstrap.Rmd</code></a></small>
      <div class="d-none name"><code>whole-cube-versus-group-specific-bootstrap.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>When calculating biodiversity indicators from a cube, we often want
confidence intervals (CIs) using bootstrapping. In
<strong>dubicube</strong>, bootstrapping can be done in two ways:</p>
<ul>
<li>
<strong>Whole-cube bootstrapping</strong>: resampling all rows in
the cube, regardless of grouping.</li>
<li>
<strong>Group-specific bootstrapping</strong>: resampling rows only
within a group of interest (e.g., a species, year, or habitat).</li>
</ul>
<p>The choice between these two methods directly affects how confidence
intervals should be interpreted:</p>
<ul>
<li>Other indicators <strong>combine information across groups</strong>
(e.g., community richness, turnover, or multi-species metrics). These
require whole-cube bootstrapping to preserve correlations.</li>
<li>Some indicators are <strong>calculated independently per
group</strong> (e.g., species-specific or year-specific metrics). For
these, group-specific bootstrapping is usually more appropriate.</li>
</ul>
<p>In this tutorial, we explain the differences, discuss the strengths
and limitations of each method, and provide a worked example where
group-specific bootstrapping is the correct choice.</p>
<div class="section level3">
<h3 id="whole-cube-bootstrap">Whole-cube bootstrap<a class="anchor" aria-label="anchor" href="#whole-cube-bootstrap"></a>
</h3>
<p><strong>Definition:</strong> Resample all rows in the cube,
regardless of species, year, or other grouping.</p>
<p><strong>Advantages:</strong></p>
<ul>
<li>Preserves correlations between groups (e.g., species co-occurrence,
temporal dependencies).</li>
<li>Appropriate for indicators that depend on multiple groups together
(community-level metrics, multi-species diversity).</li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul>
<li>Rare groups may end up with zero rows in some bootstrap replicates,
leading to wider or undefined CIs.</li>
<li>Variance for small groups may be inflated.</li>
</ul>
<p><strong>Use case examples:</strong></p>
<ul>
<li>Community richness per site or habitat.</li>
<li>Multi-species indicators (e.g., average occupancy across
species).</li>
<li>Temporal turnover indicators that rely on multiple years.</li>
</ul>
<p><strong>Implementation in <code>dubicube</code></strong></p>
<ul>
<li>Default use like tutorials and examples.</li>
</ul>
</div>
<div class="section level3">
<h3 id="group-specific-bootstrap">Group-specific bootstrap<a class="anchor" aria-label="anchor" href="#group-specific-bootstrap"></a>
</h3>
<p><strong>Definition:</strong> Subset the cube by the group of interest
(e.g., species or year), then resample rows only within that group.</p>
<p><strong>Advantages:</strong></p>
<ul>
<li>Guarantees each replicate has rows for the group → stable CIs.</li>
<li>Reflects within-group variability only.</li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul>
<li>Ignores correlations with other groups.</li>
<li>Variance may be slightly underestimated if the group’s presence is
correlated with other groups.</li>
</ul>
<p><strong>Use case examples:</strong></p>
<ul>
<li>Species-specific occupancy or habitat preference metrics.</li>
<li>Year-specific indicators (e.g., annual richness).</li>
<li>Small or rare groups where zero-row replicates would be
problematic.</li>
</ul>
<p><strong>Implementation in <code>dubicube</code></strong></p>
<ul>
<li>Perform bootstrapping and interval calculation per group (e.g. using
a for loop or <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code>).</li>
<li>See further.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="an-example-of-a-group-specific-analysis">An example of a group-specific analysis<a class="anchor" aria-label="anchor" href="#an-example-of-a-group-specific-analysis"></a>
</h2>
<p>We reuse the example introduced in <a href="https://b-cubed-eu.github.io/dubicube/articles/bootstrap-method-cubes.html">bootstrap
confidence interval calculation tutorial</a> where we calculate
confidence limits for the mean number of observations per grid cell per
year for birds in Belgium between 2011 en 2020 using the MGRS grid at 10
km scale.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>      <span class="co"># Data visualisation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>        <span class="co"># Data wrangling</span></span>
<span></span>
<span><span class="co"># Data loading and processing</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/frictionlessdata/frictionless-r" class="external-link">frictionless</a></span><span class="op">)</span> <span class="co"># Load example datasets</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/b-cubed-eu/b3gbi" class="external-link">b3gbi</a></span><span class="op">)</span>        <span class="co"># Process occurrence cubes</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/b-cubed-eu/dubicube" class="external-link">dubicube</a></span><span class="op">)</span>     <span class="co"># Analysis of data quality &amp; indicator uncertainty</span></span></code></pre></div>
<div class="section level3">
<h3 id="loading-and-processing-the-data">Loading and processing the data<a class="anchor" aria-label="anchor" href="#loading-and-processing-the-data"></a>
</h3>
<p>We load the bird cube data from the <strong>b3data</strong> data
package using <strong>frictionless</strong> (see also <a href="https://github.com/b-cubed-eu/b3data-scripts" class="external-link">here</a>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read data package</span></span>
<span><span class="va">b3data_package</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/frictionless/reference/read_package.html" class="external-link">read_package</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://zenodo.org/records/15211029/files/datapackage.json"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load bird cube data</span></span>
<span><span class="va">bird_cube_belgium</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/frictionless/reference/read_resource.html" class="external-link">read_resource</a></span><span class="op">(</span><span class="va">b3data_package</span>, <span class="st">"bird_cube_belgium_mgrs10"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bird_cube_belgium</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;    year mgrscode specieskey species          family     n mincoordinateuncerta…¹</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">473</span>958 Perdix perdix    Phasi…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">474</span>156 Coturnix coturn… Phasi…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">474</span>377 Fulica atra      Ralli…     5                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">475</span>443 Merops apiaster  Merop…     6                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">480</span>242 Vanellus vanell… Chara…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">480</span>637 Accipiter nisus  Accip…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​mincoordinateuncertaintyinmeters</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: familycount &lt;dbl&gt;</span></span></span></code></pre></div>
<p>We process the cube with <strong>b3gbi</strong>. First, we select
2000 random rows to make the dataset smaller. This is to reduce the
computation time for this tutorial. We select the data from 2011 -
2020.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make dataset smaller</span></span>
<span><span class="va">rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bird_cube_belgium</span><span class="op">)</span>, <span class="fl">2000</span><span class="op">)</span></span>
<span><span class="va">bird_cube_belgium</span> <span class="op">&lt;-</span> <span class="va">bird_cube_belgium</span><span class="op">[</span><span class="va">rows</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Process cube</span></span>
<span><span class="va">processed_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://b-cubed-eu.github.io/b3gbi/reference/process_cube.html" class="external-link">process_cube</a></span><span class="op">(</span></span>
<span>  <span class="va">bird_cube_belgium</span>,</span>
<span>  first_year <span class="op">=</span> <span class="fl">2011</span>,</span>
<span>  last_year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  cols_occurrences <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">processed_cube</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Processed data cube for calculating biodiversity indicators</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Date Range: 2011 - 2020 </span></span>
<span><span class="co">#&gt; Single-resolution cube with cell size 10km ^2 </span></span>
<span><span class="co">#&gt; Number of cells: 242 </span></span>
<span><span class="co">#&gt; Grid reference system: mgrs </span></span>
<span><span class="co">#&gt; Coordinate range:</span></span>
<span><span class="co">#&gt;    xmin    xmax    ymin    ymax </span></span>
<span><span class="co">#&gt;  280000  710000 5490000 5700000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total number of observations: 45143 </span></span>
<span><span class="co">#&gt; Number of species represented: 253 </span></span>
<span><span class="co">#&gt; Number of families represented: 57 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Kingdoms represented: Data not present </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; First 10 rows of data (use n = to show more):</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 957 × 13</span></span></span>
<span><span class="co">#&gt;     year cellCode taxonKey scientificName    family   obs minCoordinateUncerta…¹</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>011 31UFS56   5<span style="text-decoration: underline;">231</span>918 Cuculus canorus   Cucul…    11                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>011 31UES28   5<span style="text-decoration: underline;">739</span>317 Phoenicurus phoe… Musci…     6                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>011 31UFS64   6<span style="text-decoration: underline;">065</span>824 Chroicocephalus … Larid…   143                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>011 31UFS96   2<span style="text-decoration: underline;">492</span>576 Muscicapa striata Musci…     3                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>011 31UES04   5<span style="text-decoration: underline;">231</span>198 Passer montanus   Passe…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>011 31UES85   5<span style="text-decoration: underline;">229</span>493 Garrulus glandar… Corvi…    23                    707</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>011 31UES88  10<span style="text-decoration: underline;">124</span>612 Anser anser x Br… Anati…     1                    100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>011 31UES22   2<span style="text-decoration: underline;">481</span>172 Larus marinus     Larid…     8                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>011 31UFS43   2<span style="text-decoration: underline;">481</span>139 Larus argentatus  Larid…    10                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>011 31UFT00   9<span style="text-decoration: underline;">274</span>012 Spatula querqued… Anati…     8                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 947 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​minCoordinateUncertaintyInMeters</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: familyCount &lt;dbl&gt;, xcoord &lt;dbl&gt;, ycoord &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   utmzone &lt;int&gt;, hemisphere &lt;chr&gt;, resolution &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="analysis-of-the-data">Analysis of the data<a class="anchor" aria-label="anchor" href="#analysis-of-the-data"></a>
</h3>
<p>Let’s say we are interested in the mean number of observations per
grid cell per year. We create a function to calculate this.</p>
<p>In contrast to the other tutorials, we now calculate this exclusively
per year. Therefore, the group-specific bootstrap is more appropriate
here. This is because our indicator (mean observations per year) depends
only on variation within each year, and not on correlations across
years.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to calculate statistic of interest</span></span>
<span><span class="co"># Mean observations per grid cell per year</span></span>
<span><span class="va">mean_obs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">cellCode</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>diversity_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, .by <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We get the following results:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean_obs</span><span class="op">(</span><span class="va">processed_cube</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;    year diversity_val</span></span>
<span><span class="co">#&gt; 1  2011      31.28846</span></span>
<span><span class="co">#&gt; 2  2012      30.96842</span></span>
<span><span class="co">#&gt; 3  2013      36.65049</span></span>
<span><span class="co">#&gt; 4  2014      42.17143</span></span>
<span><span class="co">#&gt; 5  2015      45.76471</span></span>
<span><span class="co">#&gt; 6  2016      39.76068</span></span>
<span><span class="co">#&gt; 7  2017     119.70833</span></span>
<span><span class="co">#&gt; 8  2018      49.87963</span></span>
<span><span class="co">#&gt; 9  2019      21.06780</span></span>
<span><span class="co">#&gt; 10 2020      19.78689</span></span></code></pre></div>
<p>On their own, these values don’t reveal how much uncertainty
surrounds them. To better understand their variability, we use
bootstrapping to estimate the distribution of the yearly means. From
this distribution, we can calculate bootstrap confidence intervals.</p>
</div>
<div class="section level3">
<h3 id="group-specific-bootstrapping">Group-specific bootstrapping<a class="anchor" aria-label="anchor" href="#group-specific-bootstrapping"></a>
</h3>
<p>We use the <code><a href="../reference/bootstrap_cube.html">bootstrap_cube()</a></code> function to perform
bootstrapping (see also the <a href="https://b-cubed-eu.github.io/dubicube/articles/bootstrap-method-cubes.html">bootstrap
tutorial</a>). However, we now split the data per year and perform
bootstrapping per year using <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code>. We store the data
also in the output list to be used for interval calculation further
on.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootstrap_results_group</span> <span class="op">&lt;-</span> <span class="va">processed_cube</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">processed_cube</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">cube</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">bootstrap_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootstrap_cube.html">bootstrap_cube</a></span><span class="op">(</span></span>
<span>      data_cube <span class="op">=</span> <span class="va">cube</span>,</span>
<span>      fun <span class="op">=</span> <span class="va">mean_obs</span>,</span>
<span>      grouping_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>      samples <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>      seed <span class="op">=</span> <span class="fl">123</span>,</span>
<span>      processed_cube <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bootstrap_results <span class="op">=</span> <span class="va">bootstrap_results</span>, data <span class="op">=</span> <span class="va">cube</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bootstrap_results_group</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">bootstrap_results</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sample year est_original rep_boot est_boot  se_boot bias_boot</span></span>
<span><span class="co">#&gt; 1      1 2011     31.28846 34.61538 31.40296 5.830663    0.1145</span></span>
<span><span class="co">#&gt; 2      2 2011     31.28846 20.95192 31.40296 5.830663    0.1145</span></span>
<span><span class="co">#&gt; 3      3 2011     31.28846 20.69231 31.40296 5.830663    0.1145</span></span>
<span><span class="co">#&gt; 4      4 2011     31.28846 29.25000 31.40296 5.830663    0.1145</span></span>
<span><span class="co">#&gt; 5      5 2011     31.28846 34.47115 31.40296 5.830663    0.1145</span></span>
<span><span class="co">#&gt; 6      6 2011     31.28846 32.90385 31.40296 5.830663    0.1145</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="group-specific-interval-calculation">Group-specific interval calculation<a class="anchor" aria-label="anchor" href="#group-specific-interval-calculation"></a>
</h3>
<p>Now we can use the <code><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci()</a></code> function to
calculate confidence limits (see also the <a href="https://b-cubed-eu.github.io/dubicube/articles/bootstrap-method-cubes.html">bootstrap
confidence interval calculation tutorial</a>). Because BCa interval
calculation relies on jackknifing, we also need to do this per group
using <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ci_mean_obs_group_list</span> <span class="op">&lt;-</span> <span class="va">bootstrap_results_group</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">list</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci</a></span><span class="op">(</span></span>
<span>      <span class="va">list</span><span class="op">$</span><span class="va">bootstrap_results</span>,</span>
<span>      grouping_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>      type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"perc"</span>, <span class="st">"bca"</span>, <span class="st">"norm"</span>, <span class="st">"basic"</span><span class="op">)</span>,</span>
<span>      conf <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>      data_cube <span class="op">=</span> <span class="va">list</span><span class="op">$</span><span class="va">data</span>, <span class="co"># Required for Bca</span></span>
<span>      fun <span class="op">=</span> <span class="va">mean_obs</span>         <span class="co"># Required for Bca</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make interval type factor</span></span>
<span><span class="va">ci_mean_obs_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">ci_mean_obs_group_list</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    int_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>      <span class="va">int_type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"perc"</span>, <span class="st">"bca"</span>, <span class="st">"norm"</span>, <span class="st">"basic"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ci_mean_obs_group</span><span class="op">)</span></span>
<span><span class="co">#&gt;   year est_original est_boot  se_boot  bias_boot int_type conf       ll</span></span>
<span><span class="co">#&gt; 1 2011     31.28846 31.40296 5.830663 0.11450000     perc 0.95 20.83010</span></span>
<span><span class="co">#&gt; 2 2011     31.28846 31.40296 5.830663 0.11450000      bca 0.95 22.28181</span></span>
<span><span class="co">#&gt; 3 2011     31.28846 31.40296 5.830663 0.11450000     norm 0.95 19.74607</span></span>
<span><span class="co">#&gt; 4 2011     31.28846 31.40296 5.830663 0.11450000    basic 0.95 18.74600</span></span>
<span><span class="co">#&gt; 5 2012     30.96842 31.02205 4.566094 0.05363158     perc 0.95 22.80027</span></span>
<span><span class="co">#&gt; 6 2012     30.96842 31.02205 4.566094 0.05363158      bca 0.95 23.28024</span></span>
<span><span class="co">#&gt;         ul</span></span>
<span><span class="co">#&gt; 1 43.83092</span></span>
<span><span class="co">#&gt; 2 46.74330</span></span>
<span><span class="co">#&gt; 3 42.60185</span></span>
<span><span class="co">#&gt; 4 41.74682</span></span>
<span><span class="co">#&gt; 5 40.21998</span></span>
<span><span class="co">#&gt; 6 41.32107</span></span></code></pre></div>
<p>We visualise the results.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ci_mean_obs_group</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">est_original</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Intervals</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ll</span>, ymax <span class="op">=</span> <span class="va">ul</span><span class="op">)</span>,</span>
<span>                position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Estimates</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"firebrick"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Settings</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Mean Number of Observations\nper Grid Cell"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">ci_mean_obs_group</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">int_type</span><span class="op">)</span></span></code></pre></div>
<p><img src="whole-cube-versus-group-specific-bootstrap_files/figure-html/unnamed-chunk-13-1.png" alt="Confidence intervals for mean number of occurrences over time." width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ward Langeraert, Toon Van Daele, European Union.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
