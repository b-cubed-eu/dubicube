<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Bootstrap Method for Data Cubes • dubicube</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/PT_Sans-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Bootstrap Method for Data Cubes">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dubicube</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.10.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Tutorials</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../CONTRIBUTING.html">Contributing</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://b-cubed.eu/" aria-label="B-Cubed website"><span class="fa fa-cube"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/b-cubed-eu/dubicube/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Bootstrap Method for Data Cubes</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/b-cubed-eu/dubicube/blob/main/vignettes/articles/bootstrap-method-cubes.Rmd" class="external-link"><code>vignettes/articles/bootstrap-method-cubes.Rmd</code></a></small>
      <div class="d-none name"><code>bootstrap-method-cubes.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>When working with data cubes, it’s essential to understand the
uncertainty surrounding derived statistics. This tutorial introduces the
<code><a href="../reference/bootstrap_cube.html">bootstrap_cube()</a></code> function from <strong>dubicube</strong>,
which uses bootstrap resampling to estimate the variability, bias, and
standard error of estimates.</p>
</div>
<div class="section level2">
<h2 id="bootstrapping-for-data-cubes">Bootstrapping for data cubes<a class="anchor" aria-label="anchor" href="#bootstrapping-for-data-cubes"></a>
</h2>
<p>Bootstrapping is a resampling method used to approximate the
distribution of a statistic by repeatedly sampling from the data with
replacement. In the context of biodiversity data cubes,
<code><a href="../reference/bootstrap_cube.html">bootstrap_cube()</a></code> enables us to assess the variability of
derived statistics, such as by computing confidence intervals.</p>
<p>Note that we also make a distinction between whole-cube bootstrapping
and group-specific bootstrapping. This is further explained in <a href="https://b-cubed-eu.github.io/dubicube/articles/whole-cube-versus-group-specific-bootstrap.html">this
tutorial</a>.</p>
<div class="section level3">
<h3 id="a-data-cube-and-a-statistic">A data cube and a statistic<a class="anchor" aria-label="anchor" href="#a-data-cube-and-a-statistic"></a>
</h3>
<p>Consider a data cube <span class="math inline">\(\mathbf{X}\)</span>
from which we want to calculate a statistic <span class="math inline">\(\theta\)</span>.</p>
<ul>
<li>
<strong>Original Sample Data</strong>: <span class="math inline">\(\mathbf{X} = \{X_1, X_2, \ldots, X_n\}\)</span>
<ul>
<li>The initial set of data points. Here, <span class="math inline">\(n\)</span> is the sample size. This corresponds to
the number of cells in a data cube or the number of rows in tabular
format.</li>
</ul>
</li>
<li>
<strong>Statistic of Interest</strong>: <span class="math inline">\(\theta\)</span>
<ul>
<li>The parameter or statistic being estimated, such as the mean <span class="math inline">\(\bar{X}\)</span>, variance <span class="math inline">\(\sigma^2\)</span>, or a biodiversity indicator.
Let <span class="math inline">\(\hat{\theta}\)</span> denote the
estimated value of <span class="math inline">\(\theta\)</span>
calculated from the complete dataset <span class="math inline">\(\mathbf{X}\)</span>.</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="resampling-and-recalculating">Resampling and recalculating<a class="anchor" aria-label="anchor" href="#resampling-and-recalculating"></a>
</h3>
<p>From <span class="math inline">\(\mathbf{X}\)</span>, multiple
resampled datasets <span class="math inline">\(\mathbf{X}^*\)</span> are
created by sampling rows (cells) with replacement until each new dataset
is equally large as <span class="math inline">\(\mathbf{X}\)</span>.
This process is repeated <span class="math inline">\(B\)</span> times,
and each resample yields a new estimate <span class="math inline">\(\hat{\theta}^*_b\)</span> of the statistic.</p>
<ul>
<li>
<strong>Bootstrap Sample</strong>: <span class="math inline">\(\mathbf{X}^* = \{X_1^*, X_2^*, \ldots,
X_n^*\}\)</span>
<ul>
<li>A sample of size <span class="math inline">\(n\)</span> drawn with
replacement from the original sample <span class="math inline">\(\mathbf{X}\)</span>. Each <span class="math inline">\(X_i^*\)</span> is drawn independently from <span class="math inline">\(\mathbf{X}\)</span>.</li>
<li>A total of <span class="math inline">\(B\)</span> bootstrap samples
are drawn from the original data. Common choices for <span class="math inline">\(B\)</span> are 1000 or 10,000 to ensure a good
approximation of the distribution of the bootstrap replications (see
further).</li>
</ul>
</li>
<li>
<strong>Bootstrap Replication</strong>: <span class="math inline">\(\hat{\theta}^*_b\)</span>
<ul>
<li>The value of the statistic of interest calculated from the <span class="math inline">\(b\)</span>-th bootstrap sample <span class="math inline">\(\mathbf{X}^*_b\)</span>. For example, if <span class="math inline">\(\theta\)</span> is the sample mean, <span class="math inline">\(\hat{\theta}^*_b = \bar{X}^*_b\)</span>.</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="derivation-of-bootstrap-statistics">Derivation of bootstrap statistics<a class="anchor" aria-label="anchor" href="#derivation-of-bootstrap-statistics"></a>
</h3>
<p>The set of bootstrap replications forms the bootstrap distribution,
which can be used to estimate bootstrap statistics and construct
confidence intervals (see the <a href="https://b-cubed-eu.github.io/dubicube/articles/bootstrap-interval-calculation.html">interval
calculation tutorial</a>).</p>
<ul>
<li>
<strong>Bootstrap Estimate of the Statistic</strong>: <span class="math inline">\(\hat{\theta}_{\text{boot}}\)</span>
<ul>
<li>The average of the bootstrap replications:</li>
</ul>
</li>
</ul>
<p><span class="math display">\[
\hat{\theta}_{\text{boot}} = \frac{1}{B} \sum_{b=1}^B \hat{\theta}^*_b
\]</span></p>
<ul>
<li>
<strong>Bootstrap Bias</strong>: <span class="math inline">\(\text{Bias}_{\text{boot}}\)</span>
<ul>
<li>This bias indicates how much the bootstrap estimate deviates from
the original sample estimate. It is calculated as the difference between
the average bootstrap estimate and the original estimate:</li>
</ul>
</li>
</ul>
<p><span class="math display">\[
\text{Bias}_{\text{boot}} = \frac{1}{B} \sum_{b=1}^B (\hat{\theta}^*_b -
\hat{\theta}) = \hat{\theta}_{\text{boot}} - \hat{\theta}
\]</span></p>
<ul>
<li>
<strong>Bootstrap Standard Error</strong>: <span class="math inline">\(\text{SE}_{\text{boot}}\)</span>
<ul>
<li>The standard deviation of the bootstrap replications, which
estimates the variability of the statistic.</li>
</ul>
</li>
</ul>
<p><img src="figures/bootstrapping.png" alt="Bootstrap resampling a data cube." width="60%"></p>
</div>
</div>
<div class="section level2">
<h2 id="getting-started-with-dubicube">Getting started with dubicube<a class="anchor" aria-label="anchor" href="#getting-started-with-dubicube"></a>
</h2>
<p>The <strong>dubicube</strong> bootstrapping method can be used on any
dataframe from which a statistic is calculated and a grouping variable
is present. For this tutorial, we focus on occurrence cubes. Therefore,
we will use the <strong>b3gbi</strong> package for processing the raw
data before moving on to the bootstrapping.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>      <span class="co"># Data visualisation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>        <span class="co"># Data wrangling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>        <span class="co"># Data wrangling</span></span>
<span></span>
<span><span class="co"># Data loading and processing</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/frictionlessdata/frictionless-r" class="external-link">frictionless</a></span><span class="op">)</span> <span class="co"># Load example datasets</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/b-cubed-eu/b3gbi" class="external-link">b3gbi</a></span><span class="op">)</span>        <span class="co"># Process occurrence cubes</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/b-cubed-eu/dubicube" class="external-link">dubicube</a></span><span class="op">)</span>     <span class="co"># Analysis of data quality &amp; indicator uncertainty</span></span></code></pre></div>
<div class="section level3">
<h3 id="loading-and-processing-the-data">Loading and processing the data<a class="anchor" aria-label="anchor" href="#loading-and-processing-the-data"></a>
</h3>
<p>We load the bird cube data from the <strong>b3data</strong> data
package using <strong>frictionless</strong> (see also <a href="https://github.com/b-cubed-eu/b3data-scripts" class="external-link">here</a>). It is an
occurrence cube for birds in Belgium between 2000 en 2024 using the MGRS
grid at 10 km scale.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read data package</span></span>
<span><span class="va">b3data_package</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/frictionless/reference/read_package.html" class="external-link">read_package</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://zenodo.org/records/15211029/files/datapackage.json"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load bird cube data</span></span>
<span><span class="va">bird_cube_belgium</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/frictionless/reference/read_resource.html" class="external-link">read_resource</a></span><span class="op">(</span><span class="va">b3data_package</span>, <span class="st">"bird_cube_belgium_mgrs10"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bird_cube_belgium</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;    year mgrscode specieskey species          family     n mincoordinateuncerta…¹</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">473</span>958 Perdix perdix    Phasi…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">474</span>156 Coturnix coturn… Phasi…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">474</span>377 Fulica atra      Ralli…     5                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">475</span>443 Merops apiaster  Merop…     6                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">480</span>242 Vanellus vanell… Chara…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">480</span>637 Accipiter nisus  Accip…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​mincoordinateuncertaintyinmeters</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: familycount &lt;dbl&gt;</span></span></span></code></pre></div>
<p>We process the cube with <strong>b3gbi</strong>. First, we select
2000 random rows to make the dataset smaller. This is to reduce the
computation time for this tutorial. We select the data from 2011 -
2020.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make dataset smaller</span></span>
<span><span class="va">rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bird_cube_belgium</span><span class="op">)</span>, <span class="fl">2000</span><span class="op">)</span></span>
<span><span class="va">bird_cube_belgium</span> <span class="op">&lt;-</span> <span class="va">bird_cube_belgium</span><span class="op">[</span><span class="va">rows</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Process cube</span></span>
<span><span class="va">processed_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://b-cubed-eu.github.io/b3gbi/reference/process_cube.html" class="external-link">process_cube</a></span><span class="op">(</span></span>
<span>  <span class="va">bird_cube_belgium</span>,</span>
<span>  first_year <span class="op">=</span> <span class="fl">2011</span>,</span>
<span>  last_year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  cols_occurrences <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">processed_cube</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Processed data cube for calculating biodiversity indicators</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Date Range: 2011 - 2020 </span></span>
<span><span class="co">#&gt; Single-resolution cube with cell size 10km ^2 </span></span>
<span><span class="co">#&gt; Number of cells: 242 </span></span>
<span><span class="co">#&gt; Grid reference system: mgrs </span></span>
<span><span class="co">#&gt; Coordinate range:</span></span>
<span><span class="co">#&gt;    xmin    xmax    ymin    ymax </span></span>
<span><span class="co">#&gt;  280000  710000 5490000 5700000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total number of observations: 45143 </span></span>
<span><span class="co">#&gt; Number of species represented: 253 </span></span>
<span><span class="co">#&gt; Number of families represented: 57 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Kingdoms represented: Data not present </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; First 10 rows of data (use n = to show more):</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 957 × 13</span></span></span>
<span><span class="co">#&gt;     year cellCode taxonKey scientificName    family   obs minCoordinateUncerta…¹</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>011 31UFS56   5<span style="text-decoration: underline;">231</span>918 Cuculus canorus   Cucul…    11                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>011 31UES28   5<span style="text-decoration: underline;">739</span>317 Phoenicurus phoe… Musci…     6                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>011 31UFS64   6<span style="text-decoration: underline;">065</span>824 Chroicocephalus … Larid…   143                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>011 31UFS96   2<span style="text-decoration: underline;">492</span>576 Muscicapa striata Musci…     3                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>011 31UES04   5<span style="text-decoration: underline;">231</span>198 Passer montanus   Passe…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>011 31UES85   5<span style="text-decoration: underline;">229</span>493 Garrulus glandar… Corvi…    23                    707</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>011 31UES88  10<span style="text-decoration: underline;">124</span>612 Anser anser x Br… Anati…     1                    100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>011 31UES22   2<span style="text-decoration: underline;">481</span>172 Larus marinus     Larid…     8                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>011 31UFS43   2<span style="text-decoration: underline;">481</span>139 Larus argentatus  Larid…    10                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>011 31UFT00   9<span style="text-decoration: underline;">274</span>012 Spatula querqued… Anati…     8                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 947 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​minCoordinateUncertaintyInMeters</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: familyCount &lt;dbl&gt;, xcoord &lt;dbl&gt;, ycoord &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   utmzone &lt;int&gt;, hemisphere &lt;chr&gt;, resolution &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="analysis-of-the-data">Analysis of the data<a class="anchor" aria-label="anchor" href="#analysis-of-the-data"></a>
</h3>
<p>Let’s say we are interested in the mean number of observations per
grid cell per year. We create a function to calculate this.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to calculate the statistic of interest</span></span>
<span><span class="co"># Mean observations per grid cell per year</span></span>
<span><span class="va">mean_obs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">obs</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>, .by <span class="op">=</span> <span class="st">"cellCode"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>diversity_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, .by <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We get the following results:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean_obs</span><span class="op">(</span><span class="va">processed_cube</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;    year diversity_val</span></span>
<span><span class="co">#&gt; 1  2011      34.17777</span></span>
<span><span class="co">#&gt; 2  2012      35.27201</span></span>
<span><span class="co">#&gt; 3  2013      33.25581</span></span>
<span><span class="co">#&gt; 4  2014      55.44160</span></span>
<span><span class="co">#&gt; 5  2015      49.24754</span></span>
<span><span class="co">#&gt; 6  2016      48.34063</span></span>
<span><span class="co">#&gt; 7  2017      70.42202</span></span>
<span><span class="co">#&gt; 8  2018      48.83850</span></span>
<span><span class="co">#&gt; 9  2019      47.46795</span></span>
<span><span class="co">#&gt; 10 2020      43.00411</span></span></code></pre></div>
<p>On their own, these values don’t reveal how much uncertainty
surrounds them. To better understand their variability, we use
bootstrapping to estimate the distribution of the yearly means.</p>
</div>
<div class="section level3">
<h3 id="bootstrapping">Bootstrapping<a class="anchor" aria-label="anchor" href="#bootstrapping"></a>
</h3>
<p>We use the <code><a href="../reference/bootstrap_cube.html">bootstrap_cube()</a></code> function to do this. It
relies on the following arguments:</p>
<ul>
<li><p><strong><code>data_cube</code></strong>:<br>
The input data as a processed data cube (from
<code><a href="https://b-cubed-eu.github.io/b3gbi/reference/process_cube.html" class="external-link">b3gbi::process_cube()</a></code>).</p></li>
<li><p><strong><code>fun</code></strong>:<br>
A user-defined function that computes the statistic(s) of interest from
<code>data_cube$data</code>. This function should return a dataframe
that includes a column named <code>diversity_val</code>, containing the
statistic to evaluate.</p></li>
<li><p><strong><code>grouping_var</code></strong>:<br>
The column(s) used for grouping the output of <code>fun()</code>. For
example, if <code>fun()</code> returns one value per year, use
<code>grouping_var = "year"</code>.</p></li>
<li><p><strong><code>samples</code></strong>:<br>
The number of bootstrap samples to draw. Common values are 1000 or more
for reliable estimates of variability and confidence intervals.</p></li>
<li><p><strong><code>seed</code></strong>:<br>
An optional numeric seed to ensure reproducibility of the bootstrap
resampling. Set this to a fixed value to get consistent results across
runs.</p></li>
<li><p><strong><code>progress</code></strong>:<br>
Logical flag to show a progress bar. Set to <code>TRUE</code> to enable
progress reporting; default is <code>FALSE</code>.</p></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootstrap_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootstrap_cube.html">bootstrap_cube</a></span><span class="op">(</span></span>
<span>  data_cube <span class="op">=</span> <span class="va">processed_cube</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">mean_obs</span>,</span>
<span>  grouping_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  samples <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Performing whole-cube bootstrap with `boot::boot()`."</span></span></code></pre></div>
<p>This returned a list of <code>"boot"</code> objects. We can convert
this to a dataframe</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootstrap_results_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boot_list_to_dataframe.html">boot_list_to_dataframe</a></span><span class="op">(</span></span>
<span>  boot_list <span class="op">=</span> <span class="va">bootstrap_results</span>,</span>
<span>  grouping_var <span class="op">=</span> <span class="st">"year"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bootstrap_results_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sample year est_original rep_boot est_boot  se_boot  bias_boot</span></span>
<span><span class="co">#&gt; 1      1 2011     34.17777 31.15094  33.7093 4.304673 -0.4684721</span></span>
<span><span class="co">#&gt; 2      2 2011     34.17777 32.45489  33.7093 4.304673 -0.4684721</span></span>
<span><span class="co">#&gt; 3      3 2011     34.17777 29.31098  33.7093 4.304673 -0.4684721</span></span>
<span><span class="co">#&gt; 4      4 2011     34.17777 34.10232  33.7093 4.304673 -0.4684721</span></span>
<span><span class="co">#&gt; 5      5 2011     34.17777 25.46354  33.7093 4.304673 -0.4684721</span></span>
<span><span class="co">#&gt; 6      6 2011     34.17777 33.85088  33.7093 4.304673 -0.4684721</span></span></code></pre></div>
<p>We can visualise the bootstrap distributions using a violin plot.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get bias vales</span></span>
<span><span class="va">bias_mean_obs</span> <span class="op">&lt;-</span> <span class="va">bootstrap_results_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">year</span>, estimate <span class="op">=</span> <span class="va">est_original</span>, `bootstrap estimate` <span class="op">=</span> <span class="va">est_boot</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get estimate values</span></span>
<span><span class="va">estimate_mean_obs</span> <span class="op">&lt;-</span> <span class="va">bias_mean_obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"bootstrap estimate"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"Legend"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Legend</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"bootstrap estimate"</span><span class="op">)</span>,</span>
<span>                         ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualise bootrap distributions</span></span>
<span><span class="va">bootstrap_results_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Distribution</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">rep_boot</span>, group <span class="op">=</span> <span class="va">year</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"cornflowerblue"</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Estimates and bias</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">estimate_mean_obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">value</span>, shape <span class="op">=</span> <span class="va">Legend</span><span class="op">)</span>,</span>
<span>             colour <span class="op">=</span> <span class="st">"firebrick"</span>, size <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Settings</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Mean Number of Observations\nper Grid Cell"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">""</span>, shape <span class="op">=</span> <span class="st">"Legend:"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">bootstrap_results_df</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="bootstrap-method-cubes_files/figure-html/unnamed-chunk-9-1.png" class="r-plt" alt="Bootstrap distributions for mean number of occurrences over time." width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="advanced-usage-of-bootstrap_cube">Advanced usage of <code>bootstrap_cube()</code><a class="anchor" aria-label="anchor" href="#advanced-usage-of-bootstrap_cube"></a>
</h2>
<div class="section level3">
<h3 id="bootstrap-simple-dataframes">Bootstrap simple dataframes<a class="anchor" aria-label="anchor" href="#bootstrap-simple-dataframes"></a>
</h3>
<p>As stated in the documentation, it is also possible to bootstrap a
dataframe. In this case, set the argument
<code>processed_cube = FALSE</code>. This is implemented to allow for
flexible use of simple dataframes, while still encouraging the use of
<code><a href="https://b-cubed-eu.github.io/b3gbi/reference/process_cube.html" class="external-link">b3gbi::process_cube()</a></code> as default functionality.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootstrap_results_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootstrap_cube.html">bootstrap_cube</a></span><span class="op">(</span></span>
<span>  data_cube <span class="op">=</span> <span class="va">processed_cube</span><span class="op">$</span><span class="va">data</span>,      <span class="co"># data.frame object</span></span>
<span>  fun <span class="op">=</span> <span class="va">mean_obs</span>,</span>
<span>  grouping_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  samples <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"whole_cube"</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span>,</span>
<span>  processed_cube <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comparison-with-a-reference-group">Comparison with a reference group<a class="anchor" aria-label="anchor" href="#comparison-with-a-reference-group"></a>
</h3>
<p>A particularly insightful approach is comparing indicator values to a
reference group. In time series analyses, this often means comparing
each year’s indicator to a baseline year (e.g., the first or last year
in the series).</p>
<p>To do this, we perform bootstrapping over the differences between
indicator values:</p>
<ol style="list-style-type: decimal">
<li>Resample the dataset with replacement<br>
</li>
<li>Calculate the indicator for each group (e.g., each year)<br>
</li>
<li>For each non-reference group, compute the difference between its
indicator value and that of the reference group<br>
</li>
<li>Repeat steps 1–3 across all bootstrap iterations</li>
</ol>
<p>This process yields bootstrap replicate distributions of differences
in indicator values.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootstrap_results_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootstrap_cube.html">bootstrap_cube</a></span><span class="op">(</span></span>
<span>  data_cube <span class="op">=</span> <span class="va">processed_cube</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">mean_obs</span>,</span>
<span>  grouping_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  samples <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  ref_group <span class="op">=</span> <span class="fl">2011</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Performing whole-cube bootstrap."</span></span></code></pre></div>
<p>This time, a dataframe is returned since the <strong>boot</strong>
package cannot be used with a reference group (see Bootstrap method
section).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bootstrap_results_ref</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sample year est_original   rep_boot  est_boot  se_boot  bias_boot</span></span>
<span><span class="co">#&gt; 1      1 2012     1.094245  8.1881078 0.6583191 5.475053 -0.4359261</span></span>
<span><span class="co">#&gt; 2      2 2012     1.094245  7.6061946 0.6583191 5.475053 -0.4359261</span></span>
<span><span class="co">#&gt; 3      3 2012     1.094245 -4.6058908 0.6583191 5.475053 -0.4359261</span></span>
<span><span class="co">#&gt; 4      4 2012     1.094245  2.4102039 0.6583191 5.475053 -0.4359261</span></span>
<span><span class="co">#&gt; 5      5 2012     1.094245  6.2626545 0.6583191 5.475053 -0.4359261</span></span>
<span><span class="co">#&gt; 6      6 2012     1.094245 -0.1577162 0.6583191 5.475053 -0.4359261</span></span></code></pre></div>
<p>We see that the mean number of observations is higher in most years
compared to 2011. At what point can we say these differences are
significant? This will be further explored in the <a href="https://b-cubed-eu.github.io/dubicube/articles/effect-classification.html">effect
classification tutorial</a>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get bias vales</span></span>
<span><span class="va">bias_mean_obs</span> <span class="op">&lt;-</span> <span class="va">bootstrap_results_ref</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">year</span>, estimate <span class="op">=</span> <span class="va">est_original</span>, `bootstrap estimate` <span class="op">=</span> <span class="va">est_boot</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get estimate values</span></span>
<span><span class="va">estimate_mean_obs</span> <span class="op">&lt;-</span> <span class="va">bias_mean_obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"bootstrap estimate"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"Legend"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Legend</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"bootstrap estimate"</span><span class="op">)</span>,</span>
<span>                         ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualise bootrap distributions</span></span>
<span><span class="va">bootstrap_results_ref</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Distribution</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">rep_boot</span>, group <span class="op">=</span> <span class="va">year</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"cornflowerblue"</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Estimates and bias</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">estimate_mean_obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">value</span>, shape <span class="op">=</span> <span class="va">Legend</span><span class="op">)</span>,</span>
<span>             colour <span class="op">=</span> <span class="st">"firebrick"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Settings</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Mean Number of Observations per Grid Cell\nCompared to 2011"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">""</span>, shape <span class="op">=</span> <span class="st">"Legend:"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">bootstrap_results_ref</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="bootstrap-method-cubes_files/figure-html/unnamed-chunk-12-1.png" class="r-plt" alt="Bootstrap distributions for mean number of occurrences over time (ref)." width="700"></p>
<p>Note that the choice of the reference year should be well considered.
Keep in mind which comparisons should be made, and what the motivation
is behind the reference period. A high or low value in the reference
period relative to other periods, e.g. an exceptional bad or good year,
can affect the magnitude and direction of the calculated differences.
Whether this should be avoided or not, depends on the motivation behind
the choice and the research question. A reference period can be
determined by legislation, or by the start of a monitoring campaign. A
specific research question can determine the periods that need to be
compared. Furthermore, the variability of the estimate of reference
period affects the width of confidence intervals for the differences. A
more variable reference period will propagate greater uncertainty. In
the case of GBIF data, more data will be available in recent years than
in earlier years. If this is the case, it could make sense to select the
last period as a reference period. In a way, this also avoids the
arbitrariness of choosing the reference period. You compare previous
situations with the current situation (last year), where you could
repeat this comparison annually, for example. Finally, when comparing
multiple indicators, we recommend using a consistent reference period to
maintain comparability.</p>
</div>
<div class="section level3">
<h3 id="bootstrap-method">Bootstrap method<a class="anchor" aria-label="anchor" href="#bootstrap-method"></a>
</h3>
<p>The <strong>dubicube</strong> package supports multiple bootstrap
strategies depending on the type of indicator, the structure of your
data, and whether a reference group is used. Users rarely need to
specify the method explicitly, as the default
<code>method = "smart"</code> automatically selects the appropriate
approach. More info in <a href="https://b-cubed-eu.github.io/dubicube/articles/whole-cube-versus-group-specific-bootstrap.html">this
tutorial</a>.</p>
<div class="section level4">
<h4 id="smart-method-smart">1. Smart (<code>method = "smart"</code>)<a class="anchor" aria-label="anchor" href="#smart-method-smart"></a>
</h4>
<p>This is the default and recommended option. <strong>dubicube</strong>
infers the most suitable bootstrap method by comparing indicator values
across subsets of the data. If the values of common groups are identical
when calculated separately, group-specific bootstrapping is applied;
otherwise, whole-cube bootstrapping is used (see further).</p>
</div>
<div class="section level4">
<h4 id="whole-cube-bootstrap-method-whole_cube">2. Whole-cube bootstrap (<code>method = "whole_cube"</code>)<a class="anchor" aria-label="anchor" href="#whole-cube-bootstrap-method-whole_cube"></a>
</h4>
<p>In whole-cube bootstrapping, resampling is performed across all rows
of the dataset, ignoring the grouping variable. This is suitable for
indicators that depend on the full dataset (e.g., aggregate biodiversity
metrics).</p>
<ul>
<li>Can be used with a reference group.</li>
<li>Does not use the <strong>boot</strong> package.</li>
</ul>
</div>
<div class="section level4">
<h4 id="group-specific-bootstrap-method-group_specific">3. Group-specific bootstrap
(<code>method = "group_specific"</code>)<a class="anchor" aria-label="anchor" href="#group-specific-bootstrap-method-group_specific"></a>
</h4>
<p>Here, resampling occurs independently within each group defined by
the grouping variable (e.g., per species, year, or habitat). This method
preserves group structure and is suitable for indicators calculated
independently per group.</p>
<ul>
<li>Can be used with a reference group.</li>
<li>Does not use the <strong>boot</strong> package.</li>
</ul>
</div>
<div class="section level4">
<h4 id="boot-based-whole-cube-method-boot_whole_cube">4. Boot-based whole-cube
(<code>method = "boot_whole_cube"</code>)<a class="anchor" aria-label="anchor" href="#boot-based-whole-cube-method-boot_whole_cube"></a>
</h4>
<p>Performs whole-cube bootstrapping using the <strong>boot</strong>
package. Resampling occurs across all rows.</p>
<ul>
<li>Cannot be used with a reference group.</li>
<li>Only valid when there is a single grouping variable.</li>
</ul>
</div>
<div class="section level4">
<h4 id="boot-based-group-specific-method-boot_group_specific">5. Boot-based group-specific
(<code>method = "boot_group_specific"</code>)<a class="anchor" aria-label="anchor" href="#boot-based-group-specific-method-boot_group_specific"></a>
</h4>
<p>Performs group-specific bootstrapping using the <strong>boot</strong>
package. Resampling occurs independently within each group.</p>
<ul>
<li>Cannot be used with a reference group.</li>
<li>Only valid when there is a single grouping variable.</li>
</ul>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ward Langeraert, Toon Van Daele, <a href="https://doi.org/10.3030/101059592" class="external-link"><img src="https://github.com/b-cubed-eu/dubicube/blob/main/man/figures/eu-funded-en.png?raw=true" height="35" alt="logo of the European Union"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
