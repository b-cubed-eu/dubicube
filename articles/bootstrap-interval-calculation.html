<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Calculating Bootstrap Confidence Intervals • dubicube</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/PT_Sans-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Calculating Bootstrap Confidence Intervals">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dubicube</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Tutorials</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../CONTRIBUTING.html">Contributing</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://b-cubed.eu/" aria-label="B-Cubed website"><span class="fa fa-cube"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/b-cubed-eu/dubicube/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculating Bootstrap Confidence Intervals</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/b-cubed-eu/dubicube/blob/main/vignettes/articles/bootstrap-interval-calculation.Rmd" class="external-link"><code>vignettes/articles/bootstrap-interval-calculation.Rmd</code></a></small>
      <div class="d-none name"><code>bootstrap-interval-calculation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>When working with data cubes, it’s essential to understand the
uncertainty surrounding derived statistics. This tutorial introduces the
<code><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci()</a></code> function from
<strong>dubicube</strong>, which uses bootstrap replications to estimate
the confidence intervals around statistics calculated from data
cubes.</p>
</div>
<div class="section level2">
<h2 id="calculating-bootstrap-confidence-intervals">Calculating bootstrap confidence intervals<a class="anchor" aria-label="anchor" href="#calculating-bootstrap-confidence-intervals"></a>
</h2>
<p>In the <a href="https://b-cubed-eu.github.io/dubicube/articles/bootstrap-method-cubes.html">bootstrap
tutorial</a>, we introduced bootstrapping as a way to assess the
variability of statistics calculated from data cubes. Bootstrapping
involves repeatedly resampling the dataset and recalculating the
statistic to create a distribution of possible outcomes (= bootstrap
replicates).</p>
<p>This tutorial builds on that foundation by showing how to compute
confidence intervals from those bootstrap replicates. Confidence
intervals provide a useful summary of uncertainty by indicating a range
within which the true value of the statistic is likely to be. We
consider four different types of intervals (with confidence level <span class="math inline">\(\alpha\)</span>). The choice of confidence
interval types and their calculation is in line with the
<strong>boot</strong> package in R (Canty &amp; Ripley, <a href="https://CRAN.R-project.org/package=boot" class="external-link">1999</a>), to ensure ease
of implementation. They are based on the definitions provided by Davison
&amp; Hinkley (<a href="https://doi.org/10.1017/CBO9780511802843" class="external-link">1997,
Chapter 5</a>) (see also DiCiccio &amp; Efron, <a href="https://doi.org/10.1214/ss/1032280214" class="external-link">1996</a>; Efron, <a href="https://doi.org/10.1080/01621459.1987.10478410" class="external-link">1987</a>).</p>
<div class="section level3">
<h3 id="percentile">1. <strong>Percentile</strong><a class="anchor" aria-label="anchor" href="#percentile"></a>
</h3>
<p>Uses the percentiles of the bootstrap distribution.</p>
<p><span class="math display">\[
CI_{\text{perc}} = \left[ \hat{\theta}^*_{(\alpha/2)},
\hat{\theta}^*_{(1-\alpha/2)} \right]
\]</span></p>
<p>where <span class="math inline">\(\hat{\theta}^*_{(\alpha/2)}\)</span> and <span class="math inline">\(\hat{\theta}^*_{(1-\alpha/2)}\)</span> are the
<span class="math inline">\(\alpha/2\)</span> and <span class="math inline">\(1-\alpha/2\)</span> percentiles of the bootstrap
distribution, respectively.</p>
</div>
<div class="section level3">
<h3 id="bias-corrected-and-accelerated-bca">2. <strong>Bias-Corrected and Accelerated (BCa)</strong><a class="anchor" aria-label="anchor" href="#bias-corrected-and-accelerated-bca"></a>
</h3>
<p>Adjusts for bias and acceleration.</p>
<p><strong>Bias</strong> refers to the systematic difference between the
observed statistic from the original dataset and the center of the
bootstrap distribution of the statistic. The bias correction term is
calculated as:</p>
<p><span class="math display">\[
\hat{z}_0 = \Phi^{-1}\left(\frac{\#(\hat{\theta}^*_b &lt;
\hat{\theta})}{B}\right)
\]</span></p>
<p>where <span class="math inline">\(\#\)</span> is the counting
operator, counting the number of times <span class="math inline">\(\hat{\theta}^*_b\)</span> is smaller than <span class="math inline">\(\hat{\theta}\)</span>, and <span class="math inline">\(\Phi^{-1}\)</span> is the inverse cumulative
density function of the standard normal distribution. <span class="math inline">\(B\)</span> is the number of bootstrap samples.</p>
<p><strong>Acceleration</strong> quantifies how sensitive the
variability of the statistic is to changes in the data. See further for
how this is calculated:</p>
<ul>
<li>
<span class="math inline">\(a = 0\)</span>: The statistic’s
variability does not depend on the data (e.g., symmetric
distribution)</li>
<li>
<span class="math inline">\(a &gt; 0\)</span>: Small changes in the
data have a large effect on the statistic’s variability (e.g., positive
skew)</li>
<li>
<span class="math inline">\(a &lt; 0\)</span>: Small changes in the
data have a smaller effect on the statistic’s variability (e.g.,
negative skew)</li>
</ul>
<p>The bias and acceleration estimates are then used to calculate
adjusted percentiles:</p>
<p><span class="math display">\[
\alpha_1 = \Phi\left( \hat{z}_0 + \frac{\hat{z}_0 + z_{\alpha/2}}{1 -
\hat{a}(\hat{z}_0 + z_{\alpha/2})} \right), \quad
\alpha_2 = \Phi\left( \hat{z}_0 + \frac{\hat{z}_0 + z_{1 - \alpha/2}}{1
- \hat{a}(\hat{z}_0 + z_{1 - \alpha/2})} \right)
\]</span></p>
<p>So, we get:</p>
<p><span class="math display">\[
CI_{\text{bca}} = \left[ \hat{\theta}^*_{(\alpha_1)},
\hat{\theta}^*_{(\alpha_2)} \right]
\]</span></p>
</div>
<div class="section level3">
<h3 id="normal">3. <strong>Normal</strong><a class="anchor" aria-label="anchor" href="#normal"></a>
</h3>
<p>Assumes the bootstrap distribution of the statistic is approximately
normal:</p>
<p><span class="math display">\[
CI_{\text{norm}} = \left[\hat{\theta} - \text{Bias}_{\text{boot}} -
\text{SE}_{\text{boot}} \cdot z_{1-\alpha/2},
\hat{\theta} - \text{Bias}_{\text{boot}} + \text{SE}_{\text{boot}} \cdot
z_{1-\alpha/2} \right]
\]</span></p>
<p>where <span class="math inline">\(z_{1-\alpha/2}\)</span> is the
<span class="math inline">\(1-\alpha/2\)</span> quantile of the standard
normal distribution.</p>
</div>
<div class="section level3">
<h3 id="basic">4. <strong>Basic</strong><a class="anchor" aria-label="anchor" href="#basic"></a>
</h3>
<p>Centers the interval using percentiles:</p>
<p><span class="math display">\[
CI_{\text{basic}} = \left[ 2\hat{\theta} -
\hat{\theta}^*_{(1-\alpha/2)},
2\hat{\theta} - \hat{\theta}^*_{(\alpha/2)} \right]
\]</span></p>
<p>where <span class="math inline">\(\hat{\theta}^*_{(\alpha/2)}\)</span> and <span class="math inline">\(\hat{\theta}^*_{(1-\alpha/2)}\)</span> are the
<span class="math inline">\(\alpha/2\)</span> and <span class="math inline">\(1-\alpha/2\)</span> percentiles of the bootstrap
distribution, respectively.</p>
</div>
</div>
<div class="section level2">
<h2 id="calculating-acceleration">Calculating acceleration<a class="anchor" aria-label="anchor" href="#calculating-acceleration"></a>
</h2>
<p>The acceleration is calculated as follows:</p>
<p><span class="math display">\[
\hat{a} = \frac{1}{6} \frac{\sum_{i = 1}^{n}(I_i^3)}{\left( \sum_{i =
1}^{n}(I_i^2) \right)^{3/2}}
\]</span></p>
<p>where <span class="math inline">\(I_i\)</span> denotes the influence
of data point <span class="math inline">\(x_i\)</span> on the estimation
of <span class="math inline">\(\theta\)</span>. <span class="math inline">\(I_i\)</span> can be estimated using jackknifing.
Examples are (1) the negative jackknife: <span class="math inline">\(I_i
= (n-1)(\hat{\theta} - \hat{\theta}_{-i})\)</span>, and (2) the positive
jackknife <span class="math inline">\(I_i = (n+1)(\hat{\theta}_{-i} -
\hat{\theta})\)</span> (Frangos &amp; Schucany, <a href="https://doi.org/10.1016/0167-9473(90)90109-U" class="external-link">1990</a>). Here,
<span class="math inline">\(\hat{\theta}_{-i}\)</span> is the estimated
value leaving out the <span class="math inline">\(i\)</span>’th data
point <span class="math inline">\(x_i\)</span>. The
<strong>boot</strong> package also offers infinitesimal jackknife and
regression estimation. Implementation of these jackknife algorithms can
be explored in the future.</p>
<p>In case of the BCa interval, <code><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci()</a></code>
uses the function <code><a href="../reference/calculate_acceleration.html">calculate_acceleration()</a></code> to calculate
acceleration. The latter can also be used on its own to calculate
acceleration values to quantify the sensitivity of a statistic’s
variability to changes in the dataset. For jackknifing, it uses the
<code>perform_jackknifing()</code> function which is not exported by
<strong>dubicube</strong>.</p>
</div>
<div class="section level2">
<h2 id="getting-started-with-dubicube">Getting started with dubicube<a class="anchor" aria-label="anchor" href="#getting-started-with-dubicube"></a>
</h2>
<p>Our method can be used on any dataframe from which a statistic is
calculated and a grouping variable is present. For this tutorial, we
focus on occurrence cubes. Therefore, we will use the
<strong>b3gbi</strong> package for processing the raw data before we go
over to bootstrapping.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>      <span class="co"># Data visualisation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>        <span class="co"># Data wrangling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>        <span class="co"># Data wrangling</span></span>
<span></span>
<span><span class="co"># Data loading and processing</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/frictionlessdata/frictionless-r" class="external-link">frictionless</a></span><span class="op">)</span> <span class="co"># Load example datasets</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/b-cubed-eu/b3gbi" class="external-link">b3gbi</a></span><span class="op">)</span>        <span class="co"># Process occurrence cubes</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/b-cubed-eu/dubicube" class="external-link">dubicube</a></span><span class="op">)</span>     <span class="co"># Analysis of data quality &amp; indicator uncertainty</span></span></code></pre></div>
<div class="section level3">
<h3 id="loading-and-processing-the-data">Loading and processing the data<a class="anchor" aria-label="anchor" href="#loading-and-processing-the-data"></a>
</h3>
<p>We load the bird cube data from the <strong>b3data</strong> data
package using <strong>frictionless</strong> (see also <a href="https://github.com/b-cubed-eu/b3data-scripts" class="external-link">here</a>). It is an
occurrence cube for birds in Belgium between 2000 en 2024 using the MGRS
grid at 10 km scale.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read data package</span></span>
<span><span class="va">b3data_package</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/frictionless/reference/read_package.html" class="external-link">read_package</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://zenodo.org/records/15211029/files/datapackage.json"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load bird cube data</span></span>
<span><span class="va">bird_cube_belgium</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/frictionless/reference/read_resource.html" class="external-link">read_resource</a></span><span class="op">(</span><span class="va">b3data_package</span>, <span class="st">"bird_cube_belgium_mgrs10"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bird_cube_belgium</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;    year mgrscode specieskey species          family     n mincoordinateuncerta…¹</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">473</span>958 Perdix perdix    Phasi…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">474</span>156 Coturnix coturn… Phasi…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">474</span>377 Fulica atra      Ralli…     5                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">475</span>443 Merops apiaster  Merop…     6                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">480</span>242 Vanellus vanell… Chara…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">480</span>637 Accipiter nisus  Accip…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​mincoordinateuncertaintyinmeters</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: familycount &lt;dbl&gt;</span></span></span></code></pre></div>
<p>We process the cube with <strong>b3gbi</strong>. First, we select
2000 random rows to make the dataset smaller. This is to reduce the
computation time for this tutorial. We select the data from 2011 -
2020.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make dataset smaller</span></span>
<span><span class="va">rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bird_cube_belgium</span><span class="op">)</span>, <span class="fl">2000</span><span class="op">)</span></span>
<span><span class="va">bird_cube_belgium</span> <span class="op">&lt;-</span> <span class="va">bird_cube_belgium</span><span class="op">[</span><span class="va">rows</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Process cube</span></span>
<span><span class="va">processed_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://b-cubed-eu.github.io/b3gbi/reference/process_cube.html" class="external-link">process_cube</a></span><span class="op">(</span></span>
<span>  <span class="va">bird_cube_belgium</span>,</span>
<span>  first_year <span class="op">=</span> <span class="fl">2011</span>,</span>
<span>  last_year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>  cols_occurrences <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">processed_cube</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Processed data cube for calculating biodiversity indicators</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Date Range: 2011 - 2020 </span></span>
<span><span class="co">#&gt; Single-resolution cube with cell size 10km ^2 </span></span>
<span><span class="co">#&gt; Number of cells: 242 </span></span>
<span><span class="co">#&gt; Grid reference system: mgrs </span></span>
<span><span class="co">#&gt; Coordinate range:</span></span>
<span><span class="co">#&gt;    xmin    xmax    ymin    ymax </span></span>
<span><span class="co">#&gt;  280000  710000 5490000 5700000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total number of observations: 45143 </span></span>
<span><span class="co">#&gt; Number of species represented: 253 </span></span>
<span><span class="co">#&gt; Number of families represented: 57 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Kingdoms represented: Data not present </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; First 10 rows of data (use n = to show more):</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 957 × 13</span></span></span>
<span><span class="co">#&gt;     year cellCode taxonKey scientificName    family   obs minCoordinateUncerta…¹</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>011 31UFS56   5<span style="text-decoration: underline;">231</span>918 Cuculus canorus   Cucul…    11                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>011 31UES28   5<span style="text-decoration: underline;">739</span>317 Phoenicurus phoe… Musci…     6                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>011 31UFS64   6<span style="text-decoration: underline;">065</span>824 Chroicocephalus … Larid…   143                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>011 31UFS96   2<span style="text-decoration: underline;">492</span>576 Muscicapa striata Musci…     3                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>011 31UES04   5<span style="text-decoration: underline;">231</span>198 Passer montanus   Passe…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>011 31UES85   5<span style="text-decoration: underline;">229</span>493 Garrulus glandar… Corvi…    23                    707</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>011 31UES88  10<span style="text-decoration: underline;">124</span>612 Anser anser x Br… Anati…     1                    100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>011 31UES22   2<span style="text-decoration: underline;">481</span>172 Larus marinus     Larid…     8                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>011 31UFS43   2<span style="text-decoration: underline;">481</span>139 Larus argentatus  Larid…    10                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>011 31UFT00   9<span style="text-decoration: underline;">274</span>012 Spatula querqued… Anati…     8                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 947 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​minCoordinateUncertaintyInMeters</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: familyCount &lt;dbl&gt;, xcoord &lt;dbl&gt;, ycoord &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   utmzone &lt;int&gt;, hemisphere &lt;chr&gt;, resolution &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="analysis-of-the-data">Analysis of the data<a class="anchor" aria-label="anchor" href="#analysis-of-the-data"></a>
</h3>
<p>Let’s say we are interested in the mean number of observations per
grid cell per year. We create a function to calculate this.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to calculate statistic of interest</span></span>
<span><span class="co"># Mean number of observations per grid cell per year</span></span>
<span><span class="va">mean_obs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>, .by <span class="op">=</span> <span class="st">"cellCode"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>diversity_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, .by <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We get the following results:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean_obs</span><span class="op">(</span><span class="va">processed_cube</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;    year diversity_val</span></span>
<span><span class="co">#&gt; 1  2011      34.17777</span></span>
<span><span class="co">#&gt; 2  2012      35.27201</span></span>
<span><span class="co">#&gt; 3  2013      33.25581</span></span>
<span><span class="co">#&gt; 4  2014      55.44160</span></span>
<span><span class="co">#&gt; 5  2015      49.24754</span></span>
<span><span class="co">#&gt; 6  2016      48.34063</span></span>
<span><span class="co">#&gt; 7  2017      70.42202</span></span>
<span><span class="co">#&gt; 8  2018      48.83850</span></span>
<span><span class="co">#&gt; 9  2019      47.46795</span></span>
<span><span class="co">#&gt; 10 2020      43.00411</span></span></code></pre></div>
<p>On their own, these values don’t reveal how much uncertainty
surrounds them. To better understand their variability, we use
bootstrapping to estimate the distribution of the yearly means. From
this distribution, we can calculate bootstrap confidence intervals.</p>
</div>
<div class="section level3">
<h3 id="bootstrapping">Bootstrapping<a class="anchor" aria-label="anchor" href="#bootstrapping"></a>
</h3>
<p>We use the <code><a href="../reference/bootstrap_cube.html">bootstrap_cube()</a></code> function to perform
bootstrapping (see also the <a href="https://b-cubed-eu.github.io/dubicube/articles/bootstrap-method-cubes.html">bootstrap
tutorial</a>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootstrap_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootstrap_cube.html">bootstrap_cube</a></span><span class="op">(</span></span>
<span>  data_cube <span class="op">=</span> <span class="va">processed_cube</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">mean_obs</span>,</span>
<span>  grouping_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  samples <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bootstrap_results</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sample year est_original rep_boot est_boot se_boot  bias_boot</span></span>
<span><span class="co">#&gt; 1      1 2011     34.17777 24.23133 33.80046 4.24489 -0.3773142</span></span>
<span><span class="co">#&gt; 2      2 2011     34.17777 24.28965 33.80046 4.24489 -0.3773142</span></span>
<span><span class="co">#&gt; 3      3 2011     34.17777 31.81445 33.80046 4.24489 -0.3773142</span></span>
<span><span class="co">#&gt; 4      4 2011     34.17777 33.42530 33.80046 4.24489 -0.3773142</span></span>
<span><span class="co">#&gt; 5      5 2011     34.17777 35.03502 33.80046 4.24489 -0.3773142</span></span>
<span><span class="co">#&gt; 6      6 2011     34.17777 33.72037 33.80046 4.24489 -0.3773142</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interval-calculation">Interval calculation<a class="anchor" aria-label="anchor" href="#interval-calculation"></a>
</h3>
<p>Now we can use the <code><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci()</a></code> function to
calculate confidence limits. It relies on the following arguments:</p>
<ul>
<li><p><strong><code>bootstrap_samples_df</code></strong>: A dataframe
containing the bootstrap replicates, where each row represents a
bootstrap sample. As returned by <code><a href="../reference/bootstrap_cube.html">bootstrap_cube()</a></code>.</p></li>
<li><p><strong><code>grouping_var</code></strong>: The column(s) used
for grouping the output of <code>fun()</code>. For example, if
<code>fun()</code> returns one value per year, use
<code>grouping_var = "year"</code>.</p></li>
<li>
<p><strong><code>type</code></strong>: A character vector specifying
the type(s) of confidence intervals to compute. Options include:</p>
<ul>
<li>
<code>"perc"</code>: Percentile interval</li>
<li>
<code>"bca"</code>: Bias-corrected and accelerated interval</li>
<li>
<code>"norm"</code>: Normal interval</li>
<li>
<code>"basic"</code>: Basic interval</li>
<li>
<code>"all"</code>: Compute all available interval types
(default)</li>
</ul>
</li>
<li><p><strong><code>conf</code></strong>: The confidence level of the
intervals. Default is <code>0.95</code> (95 % confidence
level).</p></li>
<li><p><strong><code>aggregate</code></strong>: Logical. If
<code>TRUE</code> (default), the function returns confidence limits per
group. If <code>FALSE</code>, the confidence limits are added to the
original bootstrap dataframe <code>bootstrap_samples_df</code>.</p></li>
<li><p><strong><code>data_cube</code></strong>: Only used when
<code>type = "bca"</code>. The input data as a processed data cube (from
<code><a href="https://b-cubed-eu.github.io/b3gbi/reference/process_cube.html" class="external-link">b3gbi::process_cube()</a></code>).</p></li>
<li><p><strong><code>fun</code></strong>: Only used when
<code>type = "bca"</code>. A user-defined function that computes the
statistic(s) of interest from <code>data_cube$data</code>. This function
should return a dataframe that includes a column named
<code>diversity_val</code>, containing the statistic to
evaluate.</p></li>
<li><p><strong><code>progress</code></strong>: Logical flag to show a
progress bar. Set to <code>TRUE</code> to enable progress reporting;
default is <code>FALSE</code>.</p></li>
</ul>
<p>We get a warning message for BCa calculation because we are using a
relatively small dataset.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ci_mean_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci</a></span><span class="op">(</span></span>
<span>  bootstrap_samples_df <span class="op">=</span> <span class="va">bootstrap_results</span>,</span>
<span>  grouping_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"perc"</span>, <span class="st">"bca"</span>, <span class="st">"norm"</span>, <span class="st">"basic"</span><span class="op">)</span>,</span>
<span>  conf <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  data_cube <span class="op">=</span> <span class="va">processed_cube</span>,   <span class="co"># Required for BCa</span></span>
<span>  fun <span class="op">=</span> <span class="va">mean_obs</span>                <span class="co"># Required for BCa</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ci_mean_obs</span><span class="op">)</span></span>
<span><span class="co">#&gt;   year est_original est_boot   se_boot  bias_boot int_type conf       ll</span></span>
<span><span class="co">#&gt; 1 2011     34.17777 33.80046  4.244890 -0.3773142     perc 0.95 26.57582</span></span>
<span><span class="co">#&gt; 2 2012     35.27201 34.45877  3.776430 -0.8132403     perc 0.95 27.23367</span></span>
<span><span class="co">#&gt; 3 2013     33.25581 33.72937  5.351881  0.4735622     perc 0.95 24.91414</span></span>
<span><span class="co">#&gt; 4 2014     55.44160 53.13004 10.597359 -2.3115608     perc 0.95 36.04170</span></span>
<span><span class="co">#&gt; 5 2015     49.24754 48.60624  9.888400 -0.6412965     perc 0.95 34.60635</span></span>
<span><span class="co">#&gt; 6 2016     48.34063 47.10668 11.388627 -1.2339492     perc 0.95 30.82583</span></span>
<span><span class="co">#&gt;         ul</span></span>
<span><span class="co">#&gt; 1 42.77975</span></span>
<span><span class="co">#&gt; 2 41.66334</span></span>
<span><span class="co">#&gt; 3 46.62692</span></span>
<span><span class="co">#&gt; 4 77.37950</span></span>
<span><span class="co">#&gt; 5 73.13698</span></span>
<span><span class="co">#&gt; 6 73.16598</span></span></code></pre></div>
<p>We visualise the distribution of the bootstrap replicates and the
confidence intervals.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make interval type a factor</span></span>
<span><span class="va">ci_mean_obs</span> <span class="op">&lt;-</span> <span class="va">ci_mean_obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    int_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>      <span class="va">int_type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"perc"</span>, <span class="st">"bca"</span>, <span class="st">"norm"</span>, <span class="st">"basic"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get bias values</span></span>
<span><span class="va">bias_mean_obs</span> <span class="op">&lt;-</span> <span class="va">bootstrap_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">year</span>, estimate <span class="op">=</span> <span class="va">est_original</span>, `bootstrap estimate` <span class="op">=</span> <span class="va">est_boot</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get estimate values</span></span>
<span><span class="va">estimate_mean_obs</span> <span class="op">&lt;-</span> <span class="va">bias_mean_obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"bootstrap estimate"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"Legend"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Legend</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"bootstrap estimate"</span><span class="op">)</span>,</span>
<span>                         ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Visualise</span></span>
<span><span class="va">bootstrap_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Distribution</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">rep_boot</span>, group <span class="op">=</span> <span class="va">year</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"cornflowerblue"</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Estimates and bias</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">estimate_mean_obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">value</span>, shape <span class="op">=</span> <span class="va">Legend</span><span class="op">)</span>,</span>
<span>             colour <span class="op">=</span> <span class="st">"firebrick"</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Intervals</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ci_mean_obs</span>,</span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ll</span>, ymax <span class="op">=</span> <span class="va">ul</span>, colour <span class="op">=</span> <span class="va">int_type</span><span class="op">)</span>,</span>
<span>                position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Settings</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Mean Number of Observations\nper Grid Cell"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">""</span>, shape <span class="op">=</span> <span class="st">"Legend:"</span>, colour <span class="op">=</span> <span class="st">"Interval type:"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">bootstrap_results</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="bootstrap-interval-calculation_files/figure-html/unnamed-chunk-14-1.png" alt="Confidence intervals for mean number of occurrences over time." width="700"></p>
<p>See the <a href="https://b-cubed-eu.github.io/dubicube/articles/visualising-temporal-trends.html">visualising
temporal trends tutorial</a> for information on which interval types
should be calculated and/or reported and how temporal trends can be
visualised.</p>
</div>
</div>
<div class="section level2">
<h2 id="advanced-usage-of-calculate_bootstrap_ci">Advanced usage of <code>calculate_bootstrap_ci()</code><a class="anchor" aria-label="anchor" href="#advanced-usage-of-calculate_bootstrap_ci"></a>
</h2>
<div class="section level3">
<h3 id="comparison-with-a-reference-group">Comparison with a reference group<a class="anchor" aria-label="anchor" href="#comparison-with-a-reference-group"></a>
</h3>
<p>As discussed in the <a href="https://b-cubed-eu.github.io/dubicube/articles/bootstrap-method-cubes.html">bootstrap
tutorial</a>, we can also compare indicator values to a reference group.
In time series analyses, this often means comparing each year’s
indicator to a baseline year (e.g., the first or last year in the
series). To do this, we perform bootstrapping over the difference
between indicator values. This process yields bootstrap replicate
distributions of differences in indicator values.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootstrap_results_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootstrap_cube.html">bootstrap_cube</a></span><span class="op">(</span></span>
<span>  data_cube <span class="op">=</span> <span class="va">processed_cube</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">mean_obs</span>,</span>
<span>  grouping_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  samples <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  ref_group <span class="op">=</span> <span class="fl">2011</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bootstrap_results_ref</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sample year est_original   rep_boot  est_boot  se_boot  bias_boot</span></span>
<span><span class="co">#&gt; 1      1 2012     1.094245  8.1881078 0.6583191 5.475053 -0.4359261</span></span>
<span><span class="co">#&gt; 2      2 2012     1.094245  7.6061946 0.6583191 5.475053 -0.4359261</span></span>
<span><span class="co">#&gt; 3      3 2012     1.094245 -4.6058908 0.6583191 5.475053 -0.4359261</span></span>
<span><span class="co">#&gt; 4      4 2012     1.094245  2.4102039 0.6583191 5.475053 -0.4359261</span></span>
<span><span class="co">#&gt; 5      5 2012     1.094245  6.2626545 0.6583191 5.475053 -0.4359261</span></span>
<span><span class="co">#&gt; 6      6 2012     1.094245 -0.1577162 0.6583191 5.475053 -0.4359261</span></span></code></pre></div>
<p>If the BCa interval is calculated and a reference group is used,
jackknifing is implemented differently. Consider <span class="math inline">\(\hat{\theta} = \hat{\theta}_1 -
\hat{\theta}_2\)</span> where <span class="math inline">\(\hat{\theta}_1\)</span> is the estimate for the
indicator value of a non-reference period (sample size <span class="math inline">\(n_1\)</span>) and <span class="math inline">\(\hat{\theta}_2\)</span> is the estimate for the
indicator value of a reference period (sample size <span class="math inline">\(n_2\)</span>). The acceleration is now calculated
as follows:</p>
<p><span class="math display">\[
\hat{a} = \frac{1}{6} \frac{\sum_{i = 1}^{n_1 + n_2}(I_i^3)}{\left(
\sum_{i = 1}^{n_1 + n_2}(I_i^2) \right)^{3/2}}
\]</span></p>
<p><span class="math inline">\(I_i\)</span> can be calculated using the
negative or positive jackknife. Such that</p>
<p><span class="math inline">\(\hat{\theta}_{-i} = \hat{\theta}_{1,-i} -
\hat{\theta}_2 \text{ for } i = 1, \ldots, n_1\)</span>, and</p>
<p><span class="math inline">\(\hat{\theta}_{-i} = \hat{\theta}_{1} -
\hat{\theta}_{2,-i} \text{ for } i = n_1 + 1, \ldots, n_1 +
n_2\)</span></p>
<p>Therefore, if you want to calculate the BCa intervals using
<code><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci()</a></code>, you also need to provide
<code>ref_group = 2011</code>.</p>
<pre><code><span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ci_mean_obs_ref</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">int_type</span> <span class="op">==</span> <span class="st">"bca"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   year est_original    est_boot   se_boot  bias_boot int_type conf         ll</span></span>
<span><span class="co">#&gt; 1 2012    1.0942452  0.65831911  5.475053 -0.4359261      bca 0.95 -10.762164</span></span>
<span><span class="co">#&gt; 2 2013   -0.9219589 -0.07108256  6.690590  0.8508764      bca 0.95 -12.851385</span></span>
<span><span class="co">#&gt; 3 2014   21.2638321 19.32958556 10.982093 -1.9342466      bca 0.95   5.818720</span></span>
<span><span class="co">#&gt; 4 2015   15.0697689 14.80578656 10.723767 -0.2639823      bca 0.95   2.503933</span></span>
<span><span class="co">#&gt; 5 2016   14.1628569 13.30622198 12.131657 -0.8566350      bca 0.95  -1.755266</span></span>
<span><span class="co">#&gt; 6 2017   36.2442462 43.13141123 23.943155  6.8871650      bca 0.95   7.190653</span></span>
<span><span class="co">#&gt;         ul</span></span>
<span><span class="co">#&gt; 1 11.04344</span></span>
<span><span class="co">#&gt; 2 13.06589</span></span>
<span><span class="co">#&gt; 3 57.17064</span></span>
<span><span class="co">#&gt; 4 58.08685</span></span>
<span><span class="co">#&gt; 5 52.49345</span></span>
<span><span class="co">#&gt; 6 96.55713</span></span></code></pre></div>
<p>We see that the mean number of observations is higher in some years
compared to 2011. Because the BCa intervals are above 0 in 2014, 2015,
2017 and 2018, we might even say it is significant for those years. This
will be further explored in the <a href="https://b-cubed-eu.github.io/dubicube/articles/effect-classification.html">effect
classification tutorial</a>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make interval type factor</span></span>
<span><span class="va">ci_mean_obs_ref</span> <span class="op">&lt;-</span> <span class="va">ci_mean_obs_ref</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    int_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>      <span class="va">int_type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"perc"</span>, <span class="st">"bca"</span>, <span class="st">"norm"</span>, <span class="st">"basic"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get bias vales</span></span>
<span><span class="va">bias_mean_obs</span> <span class="op">&lt;-</span> <span class="va">bootstrap_results_ref</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">year</span>, estimate <span class="op">=</span> <span class="va">est_original</span>, `bootstrap estimate` <span class="op">=</span> <span class="va">est_boot</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get estimate values</span></span>
<span><span class="va">estimate_mean_obs</span> <span class="op">&lt;-</span> <span class="va">bias_mean_obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"bootstrap estimate"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"Legend"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Legend</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"bootstrap estimate"</span><span class="op">)</span>,</span>
<span>                         ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Visualise</span></span>
<span><span class="va">bootstrap_results_ref</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Distribution</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">rep_boot</span>, group <span class="op">=</span> <span class="va">year</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"cornflowerblue"</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Estimates and bias</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">estimate_mean_obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">value</span>, shape <span class="op">=</span> <span class="va">Legend</span><span class="op">)</span>,</span>
<span>             colour <span class="op">=</span> <span class="st">"firebrick"</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Intervals</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ci_mean_obs_ref</span>,</span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ll</span>, ymax <span class="op">=</span> <span class="va">ul</span>, colour <span class="op">=</span> <span class="va">int_type</span><span class="op">)</span>,</span>
<span>                position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Settings</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Mean Number of Observations\nper Grid Cell Compared to 2011"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">""</span>, shape <span class="op">=</span> <span class="st">"Legend:"</span>, colour <span class="op">=</span> <span class="st">"Interval type:"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">bootstrap_results_ref</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using shapes for an ordinal variable is not advised</span></span></code></pre></div>
<p><img src="bootstrap-interval-calculation_files/figure-html/unnamed-chunk-20-1.png" alt="Confidence intervals for mean number of occurrences over time (ref)." width="700"></p>
<p>Note that the choice of the reference year should be well considered.
Keep in mind which comparisons should be made, and what the motivation
is behind the reference period. A high or low value in the reference
period relative to other periods, e.g. an exceptional bad or good year,
can affect the magnitude and direction of the calculated differences.
Whether this should be avoided or not, depends on the motivation behind
the choice and the research question. A reference period can be
determined by legislation, or by the start of a monitoring campaign. A
specific research question can determine the periods that need to be
compared. Furthermore, the variability of the estimate of reference
period affects the width of confidence intervals for the differences. A
more variable reference period will propagate greater uncertainty. In
the case of GBIF data, more data will be available in recent years than
in earlier years. If this is the case, it could make sense to select the
last period as a reference period. In a way, this also avoids the
arbitrariness of choice for the reference period. You compare previous
situations with the current situation (last year), where you could
repeat this comparison annually, for example. Finally, when comparing
multiple indicators, we recommend using a consistent reference period to
maintain comparability</p>
</div>
<div class="section level3">
<h3 id="transformations">Transformations<a class="anchor" aria-label="anchor" href="#transformations"></a>
</h3>
<p>Consider the calculation of Pielou’s evenness on a random subset of
the data from 2011-2015. We take only a small subset of the dataset and
we artificially create a community with high evenness. This is an
indicator that has values between 0 and 1. Higher evenness values
indicate a more balanced community (a value of 1 means that all species
are equally abundant), while low values indicate a more unbalanced
community (a value of 0 means that one species dominates
completely).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make dataset smaller</span></span>
<span><span class="va">rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bird_cube_belgium</span><span class="op">)</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">bird_cube_belgium_even</span> <span class="op">&lt;-</span> <span class="va">bird_cube_belgium</span><span class="op">[</span><span class="va">rows</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Make dataset even</span></span>
<span><span class="va">bird_cube_belgium_even</span><span class="op">$</span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">rnbinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bird_cube_belgium_even</span><span class="op">)</span>,</span>
<span>                                    size <span class="op">=</span> <span class="fl">2</span>, mu <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Process cube</span></span>
<span><span class="va">processed_cube_even</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://b-cubed-eu.github.io/b3gbi/reference/process_cube.html" class="external-link">process_cube</a></span><span class="op">(</span></span>
<span>  <span class="va">bird_cube_belgium_even</span>,</span>
<span>  first_year <span class="op">=</span> <span class="fl">2011</span>,</span>
<span>  last_year <span class="op">=</span> <span class="fl">2015</span>,</span>
<span>  cols_occurrences <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We create a custom function to calculate evenness:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calc_evenness</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># Calculate number of observations</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">scientificName</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>obs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop_last"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># Calculate evenness by year</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      tot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>,</span>
<span>      p <span class="op">=</span> <span class="va">obs</span> <span class="op">/</span> <span class="va">tot</span>,</span>
<span>      p_ln_p <span class="op">=</span> <span class="va">p</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>,</span>
<span>      ln_S <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">scientificName</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      diversity_val <span class="op">=</span> <span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">p_ln_p</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">ln_S</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># Get distinct values</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">diversity_val</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We perform bootstrapping as before. Note that you can also perform
bootstrapping of <code>processed_cube_even</code> using the
<strong>b3gbi</strong> function <code><a href="https://b-cubed-eu.github.io/b3gbi/reference/pielou_evenness_map.html" class="external-link">pielou_evenness_ts()</a></code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootstrap_results_evenness</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootstrap_cube.html">bootstrap_cube</a></span><span class="op">(</span></span>
<span>  data_cube <span class="op">=</span> <span class="va">processed_cube_even</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">calc_evenness</span>,</span>
<span>  grouping_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  samples <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We calculate the percentile, BCa, normal and basic intervals with
<code><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci()</a></code>. We get a warning message for BCa
calculation because we are using a relatively small dataset.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ci_evenness</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci</a></span><span class="op">(</span></span>
<span>  bootstrap_samples_df <span class="op">=</span> <span class="va">bootstrap_results_evenness</span>,</span>
<span>  grouping_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"perc"</span>, <span class="st">"bca"</span>, <span class="st">"norm"</span>, <span class="st">"basic"</span><span class="op">)</span>,</span>
<span>  data_cube <span class="op">=</span> <span class="va">processed_cube_even</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">calc_evenness</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make interval type factor</span></span>
<span><span class="va">ci_evenness</span> <span class="op">&lt;-</span> <span class="va">ci_evenness</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    int_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>      <span class="va">int_type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"perc"</span>, <span class="st">"bca"</span>, <span class="st">"norm"</span>, <span class="st">"basic"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get bias vales</span></span>
<span><span class="va">bias_mean_obs</span> <span class="op">&lt;-</span> <span class="va">bootstrap_results_evenness</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">year</span>, estimate <span class="op">=</span> <span class="va">est_original</span>, `bootstrap estimate` <span class="op">=</span> <span class="va">est_boot</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get estimate values</span></span>
<span><span class="va">estimate_mean_obs</span> <span class="op">&lt;-</span> <span class="va">bias_mean_obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"bootstrap estimate"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"Legend"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Legend</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"bootstrap estimate"</span><span class="op">)</span>,</span>
<span>                         ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Visualise</span></span>
<span><span class="va">bootstrap_results_evenness</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Distribution</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">rep_boot</span>, group <span class="op">=</span> <span class="va">year</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"cornflowerblue"</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Estimates and bias</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">estimate_mean_obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">value</span>, shape <span class="op">=</span> <span class="va">Legend</span><span class="op">)</span>,</span>
<span>             colour <span class="op">=</span> <span class="st">"firebrick"</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Intervals</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ci_evenness</span>,</span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ll</span>, ymax <span class="op">=</span> <span class="va">ul</span>, colour <span class="op">=</span> <span class="va">int_type</span><span class="op">)</span>,</span>
<span>                position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Settings</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Evenness"</span>, x <span class="op">=</span> <span class="st">""</span>, shape <span class="op">=</span> <span class="st">"Legend:"</span>, colour <span class="op">=</span> <span class="st">"Interval type:"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">bootstrap_results_evenness</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using shapes for an ordinal variable is not advised</span></span></code></pre></div>
<p><img src="bootstrap-interval-calculation_files/figure-html/unnamed-chunk-28-1.png" alt="Confidence intervals for evenness over time." width="700"></p>
<p>We notice that the normal and basic intervals have limits larger than
1 which is an impossible value for evenness. This is because their
intervals are symmetrical around <span class="math inline">\(\hat{\theta} - \text{Bias}_{\text{boot}}\)</span>.
We can use transformation functions to account for this. The intervals
are calculated on the scale of <code>h</code> and the inverse function
<code>hinv</code> are applied to the resulting intervals. For values
between 0 and 1, we can use the logit function and its inverse:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Logit transformation</span></span>
<span><span class="va">logit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">p</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Inverse logit transformation</span></span>
<span><span class="va">inv_logit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">l</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">l</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">l</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We enter them through <code><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci()</a></code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ci_evenness_trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci</a></span><span class="op">(</span></span>
<span>  bootstrap_samples_df <span class="op">=</span> <span class="va">bootstrap_results_evenness</span>,</span>
<span>  grouping_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"perc"</span>, <span class="st">"bca"</span>, <span class="st">"norm"</span>, <span class="st">"basic"</span><span class="op">)</span>,</span>
<span>  h <span class="op">=</span> <span class="va">logit</span>,</span>
<span>  hinv <span class="op">=</span> <span class="va">inv_logit</span>,</span>
<span>  data_cube <span class="op">=</span> <span class="va">processed_cube_even</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">calc_evenness</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make interval type factor</span></span>
<span><span class="va">ci_evenness_trans</span> <span class="op">&lt;-</span> <span class="va">ci_evenness_trans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    int_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>      <span class="va">int_type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"perc"</span>, <span class="st">"bca"</span>, <span class="st">"norm"</span>, <span class="st">"basic"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get bias vales</span></span>
<span><span class="va">bias_mean_obs</span> <span class="op">&lt;-</span> <span class="va">bootstrap_results_evenness</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">year</span>, estimate <span class="op">=</span> <span class="va">est_original</span>, `bootstrap estimate` <span class="op">=</span> <span class="va">est_boot</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get estimate values</span></span>
<span><span class="va">estimate_mean_obs</span> <span class="op">&lt;-</span> <span class="va">bias_mean_obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"bootstrap estimate"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"Legend"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Legend</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"bootstrap estimate"</span><span class="op">)</span>,</span>
<span>                         ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Visualise</span></span>
<span><span class="va">bootstrap_results_evenness</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Distribution</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">rep_boot</span>, group <span class="op">=</span> <span class="va">year</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"cornflowerblue"</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Estimates and bias</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">estimate_mean_obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">value</span>, shape <span class="op">=</span> <span class="va">Legend</span><span class="op">)</span>,</span>
<span>             colour <span class="op">=</span> <span class="st">"firebrick"</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Intervals</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ci_evenness_trans</span>,</span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ll</span>, ymax <span class="op">=</span> <span class="va">ul</span>, colour <span class="op">=</span> <span class="va">int_type</span><span class="op">)</span>,</span>
<span>                position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Settings</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Evenness"</span>, x <span class="op">=</span> <span class="st">""</span>, shape <span class="op">=</span> <span class="st">"Legend:"</span>, colour <span class="op">=</span> <span class="st">"Interval type:"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">bootstrap_results_evenness</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using shapes for an ordinal variable is not advised</span></span></code></pre></div>
<p><img src="bootstrap-interval-calculation_files/figure-html/unnamed-chunk-32-1.png" alt="Confidence intervals for evenness over time." width="700"></p>
<p>Now we see that all the intervals fall within the expected range.</p>
</div>
<div class="section level3">
<h3 id="issues-with-bias-correction-for-species-richness-indicators">Issues with bias correction for species richness indicators<a class="anchor" aria-label="anchor" href="#issues-with-bias-correction-for-species-richness-indicators"></a>
</h3>
<p>Consider the calculation of observed species richness on the same
subset used in the previous subsection. We create a custom function to
calculate richness:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calc_richness</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>diversity_val <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">scientificName</span><span class="op">)</span>,</span>
<span>                     .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We perform bootstrapping as before. Note that you can also perform
bootstrapping of <code>processed_cube_small</code> using the
<strong>b3gbi</strong> function <code><a href="https://b-cubed-eu.github.io/b3gbi/reference/obs_richness_map.html" class="external-link">obs_richness_ts()</a></code>. In this
case, a group-specific bootstrap would be more appropriate, but for the
sake of simplicity we stick to the whole-cube bootstrap here. For a
detailed discussion of when to use each approach, see <a href="https://b-cubed-eu.github.io/dubicube/articles/whole-cube-versus-group-specific-bootstrap.html">this
tutorial</a>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootstrap_results_richness</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootstrap_cube.html">bootstrap_cube</a></span><span class="op">(</span></span>
<span>  data_cube <span class="op">=</span> <span class="va">processed_cube_even</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">calc_richness</span>,</span>
<span>  grouping_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  samples <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We calculate the percentile, BCa, normal and basic intervals with
<code><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci()</a></code>. We get a warning message for BCa
calculation. The bias is infinite such that the BCa intervals cannot be
calculated.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ci_richness</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci</a></span><span class="op">(</span></span>
<span>  bootstrap_samples_df <span class="op">=</span> <span class="va">bootstrap_results_richness</span>,</span>
<span>  grouping_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"perc"</span>, <span class="st">"bca"</span>, <span class="st">"norm"</span>, <span class="st">"basic"</span><span class="op">)</span>,</span>
<span>  data_cube <span class="op">=</span> <span class="va">processed_cube_even</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">calc_richness</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in bca_ci(t0 = unique(df$est_original), t = df$rep_boot, a = a, :</span></span>
<span><span class="co">#&gt; Estimated adjustment 'z0' is infinite.</span></span>
<span><span class="co">#&gt; Warning in bca_ci(t0 = unique(df$est_original), t = df$rep_boot, a = a, :</span></span>
<span><span class="co">#&gt; Estimated adjustment 'z0' is infinite.</span></span>
<span><span class="co">#&gt; Warning in bca_ci(t0 = unique(df$est_original), t = df$rep_boot, a = a, :</span></span>
<span><span class="co">#&gt; Estimated adjustment 'z0' is infinite.</span></span>
<span><span class="co">#&gt; Warning in bca_ci(t0 = unique(df$est_original), t = df$rep_boot, a = a, :</span></span>
<span><span class="co">#&gt; Estimated adjustment 'z0' is infinite.</span></span>
<span><span class="co">#&gt; Warning in bca_ci(t0 = unique(df$est_original), t = df$rep_boot, a = a, :</span></span>
<span><span class="co">#&gt; Estimated adjustment 'z0' is infinite.</span></span></code></pre></div>
<p>We notice that none of the intervals cover the estimate. The
percentile interval does not account for bias, the BCa interval cannot
be calculated because the bias is too large and the normal and basic
intervals have overcompensated because of the large bootstrap bias.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make interval type factor</span></span>
<span><span class="va">ci_richness</span> <span class="op">&lt;-</span> <span class="va">ci_richness</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    int_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>      <span class="va">int_type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"perc"</span>, <span class="st">"bca"</span>, <span class="st">"norm"</span>, <span class="st">"basic"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get bias vales</span></span>
<span><span class="va">bias_mean_obs</span> <span class="op">&lt;-</span> <span class="va">bootstrap_results_richness</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">year</span>, estimate <span class="op">=</span> <span class="va">est_original</span>, `bootstrap estimate` <span class="op">=</span> <span class="va">est_boot</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get estimate values</span></span>
<span><span class="va">estimate_mean_obs</span> <span class="op">&lt;-</span> <span class="va">bias_mean_obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"bootstrap estimate"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"Legend"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Legend</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"bootstrap estimate"</span><span class="op">)</span>,</span>
<span>                         ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Visualise</span></span>
<span><span class="va">bootstrap_results_richness</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Distribution</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">rep_boot</span>, group <span class="op">=</span> <span class="va">year</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"cornflowerblue"</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Estimates and bias</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">estimate_mean_obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">value</span>, shape <span class="op">=</span> <span class="va">Legend</span><span class="op">)</span>,</span>
<span>             colour <span class="op">=</span> <span class="st">"firebrick"</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Intervals</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ci_richness</span>,</span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ll</span>, ymax <span class="op">=</span> <span class="va">ul</span>, colour <span class="op">=</span> <span class="va">int_type</span><span class="op">)</span>,</span>
<span>                position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Settings</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Observed species richness"</span>, x <span class="op">=</span> <span class="st">""</span>, shape <span class="op">=</span> <span class="st">"Legend:"</span>,</span>
<span>       colour <span class="op">=</span> <span class="st">"Interval type:"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">bootstrap_results_richness</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using shapes for an ordinal variable is not advised</span></span></code></pre></div>
<p><img src="bootstrap-interval-calculation_files/figure-html/unnamed-chunk-39-1.png" alt="Confidence intervals for richness over time." width="700"></p>
<p>This issue arises because bootstrap resampling cannot introduce new
species that were not present in the original sample (Dixon, <a href="https://doi.org/10.1093/oso/9780195131871.003.0014" class="external-link">2001,
p. 287</a>). As a result, the observed species richness — which is
simply the count of unique species — tends to be negatively biased in
bootstrap replicates. This leads to an extreme mismatch between the
original estimate and the distribution of bootstrap replicates. In such
cases, the BCa intervals may fail altogether (e.g., due to infinite bias
correction factors), and other bootstrap intervals (normal, basic) may
overcorrect.</p>
<p>There is an option within <code><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci()</a></code> to
center the confidence limits around the original estimate
(<code>no_bias = TRUE</code>). This means the bootstrap distribution is
used to calculate confidence intervals, except for the bootstrap bias.
While it may “solve” technical problems with interval calculation (like
infinite or undefined corrections), it does so at the cost of ignoring
bootstrap bias. This approach should only be used with caution and clear
justification, such as when the bootstrap bias is known to be an
artifact of a sampling limitation and not of the underlying data
structure.</p>
<p>Because of this inherent limitation, alternative richness estimators
that account for undetected species are preferred when uncertainty
quantification is needed. The <strong>vegan</strong> (Oksanen et al., <a href="https://cran.r-project.org/web/packages/vegan/index.html" class="external-link">2024</a>)
and <strong>iNEXT</strong> (Hsieh et al., <a href="https://doi.org/10.1111/2041-210X.12613" class="external-link">2016</a>) R packages
provide such estimators, including Chao, Jackknife, and coverage-based
rarefaction/extrapolation, all of which are designed to handle unseen
species and provide meaningful uncertainty estimates.</p>
<p>Some of these estimators are also implemented directly for occurrence
cubes in recent versions of <strong>b3gbi</strong> (≥ v0.4.0), offering
integration into existing cube-based workflows. However, it is important
to note that these are alternative estimators — they are not equivalent
to observed richness and will yield different values by design.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ci_richness_no_bias</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci</a></span><span class="op">(</span></span>
<span>  bootstrap_samples_df <span class="op">=</span> <span class="va">bootstrap_results_richness</span>,</span>
<span>  grouping_var <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"perc"</span>, <span class="st">"bca"</span>, <span class="st">"norm"</span>, <span class="st">"basic"</span><span class="op">)</span>,</span>
<span>  no_bias <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  data_cube <span class="op">=</span> <span class="va">processed_cube_even</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">calc_richness</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Indeed, the intervals are now centered around the original
estimate.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make interval type factor</span></span>
<span><span class="va">ci_richness_no_bias</span> <span class="op">&lt;-</span> <span class="va">ci_richness_no_bias</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    int_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>      <span class="va">int_type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"perc"</span>, <span class="st">"bca"</span>, <span class="st">"norm"</span>, <span class="st">"basic"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get bias vales</span></span>
<span><span class="va">bias_mean_obs</span> <span class="op">&lt;-</span> <span class="va">bootstrap_results_richness</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">year</span>, estimate <span class="op">=</span> <span class="va">est_original</span>, `bootstrap estimate` <span class="op">=</span> <span class="va">est_boot</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get estimate values</span></span>
<span><span class="va">estimate_mean_obs</span> <span class="op">&lt;-</span> <span class="va">bias_mean_obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"bootstrap estimate"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"Legend"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Legend</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"bootstrap estimate"</span><span class="op">)</span>,</span>
<span>                         ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Visualise</span></span>
<span><span class="va">bootstrap_results_richness</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Distribution</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">rep_boot</span>, group <span class="op">=</span> <span class="va">year</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"cornflowerblue"</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Estimates and bias</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">estimate_mean_obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">value</span>, shape <span class="op">=</span> <span class="va">Legend</span><span class="op">)</span>,</span>
<span>             colour <span class="op">=</span> <span class="st">"firebrick"</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Intervals</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ci_richness_no_bias</span>,</span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ll</span>, ymax <span class="op">=</span> <span class="va">ul</span>, colour <span class="op">=</span> <span class="va">int_type</span><span class="op">)</span>,</span>
<span>                position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Settings</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Observed species richness"</span>, x <span class="op">=</span> <span class="st">""</span>, shape <span class="op">=</span> <span class="st">"Legend:"</span>,</span>
<span>       colour <span class="op">=</span> <span class="st">"Interval type:"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">bootstrap_results_richness</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using shapes for an ordinal variable is not advised</span></span></code></pre></div>
<p><img src="bootstrap-interval-calculation_files/figure-html/unnamed-chunk-42-1.png" alt="Confidence intervals for richness over time." width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<!-- spell-check: ignore:start -->
<p>Canty, A., &amp; Ripley, B. (1999). boot: Bootstrap Functions
(Originally by Angelo Canty for S) [Computer software]. <a href="https://CRAN.R-project.org/package=boot" class="external-link uri">https://CRAN.R-project.org/package=boot</a></p>
<p>Davison, A. C., &amp; Hinkley, D. V. (1997). <em>Bootstrap Methods
and their Application</em> (1st ed.). Cambridge University Press. <a href="https://doi.org/10.1017/CBO9780511802843" class="external-link uri">https://doi.org/10.1017/CBO9780511802843</a></p>
<p>DiCiccio, T. J., &amp; Efron, B. (1996). Bootstrap confidence
intervals. Statistical Science, 11(3). <a href="https://doi.org/10.1214/ss/1032280214" class="external-link uri">https://doi.org/10.1214/ss/1032280214</a></p>
<p>Dixon, P. M. (2001). The Bootstrap and the Jackknife: Describing the
Precision of Ecological Indices. In S. M. Scheiner &amp; J. Gurevitch
(Eds.), Design and Analysis of Ecological Experiments (Second Edition,
pp. 267–288). Oxford University PressNew York, NY. <a href="https://doi.org/10.1093/oso/9780195131871.003.0014" class="external-link uri">https://doi.org/10.1093/oso/9780195131871.003.0014</a></p>
<p>Efron, B. (1987). Better Bootstrap Confidence Intervals. Journal of
the American Statistical Association, 82(397), 171–185. <a href="https://doi.org/10.1080/01621459.1987.10478410" class="external-link uri">https://doi.org/10.1080/01621459.1987.10478410</a></p>
<p>Frangos, C. C., &amp; Schucany, W. R. (1990). Jackknife estimation of
the bootstrap acceleration constant. Computational Statistics &amp; Data
Analysis, 9(3), 271–281. <a href="https://doi.org/10.1016/0167-9473(90)90109-U" class="external-link uri">https://doi.org/10.1016/0167-9473(90)90109-U</a>
<!-- spell-check: ignore:end --></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ward Langeraert, Toon Van Daele, European Union.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
