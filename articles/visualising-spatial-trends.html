<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Visualising Spatial Trends • dubicube</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/PT_Sans-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Visualising Spatial Trends">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dubicube</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Tutorials</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../CONTRIBUTING.html">Contributing</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://b-cubed.eu/" aria-label="B-Cubed website"><span class="fa fa-cube"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/b-cubed-eu/dubicube/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Visualising Spatial Trends</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/b-cubed-eu/dubicube/blob/main/vignettes/articles/visualising-spatial-trends.Rmd" class="external-link"><code>vignettes/articles/visualising-spatial-trends.Rmd</code></a></small>
      <div class="d-none name"><code>visualising-spatial-trends.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This tutorial provides good practices regarding visualisation and
interpretation of trends of indicators in space. The methods discussed
here are more broadly applicable, be for this tutorial we focus on
occurrence cubes from which biodiversity indicators are derived.</p>
</div>
<div class="section level2">
<h2 id="calculating-confidence-intervals-with-dubicube">Calculating confidence intervals with dubicube<a class="anchor" aria-label="anchor" href="#calculating-confidence-intervals-with-dubicube"></a>
</h2>
<p>We reuse the example introduced in <a href="https://b-cubed-eu.github.io/dubicube/articles/bootstrap-method-cubes.html">bootstrap
confidence interval calculation tutorial</a> where we look at an
occurrence cube of birds in Belgium between 2000 en 2024 using the MGRS
grid at 10 km scale. We calculate confidence limits for the mean number
of observations per grid cell.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>      <span class="co"># Data visualisation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>        <span class="co"># Data wrangling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>           <span class="co"># Work with spatial objects</span></span>
<span></span>
<span><span class="co"># Data loading and processing</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/frictionlessdata/frictionless-r" class="external-link">frictionless</a></span><span class="op">)</span> <span class="co"># Load example datasets</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/b-cubed-eu/b3gbi" class="external-link">b3gbi</a></span><span class="op">)</span>        <span class="co"># Process occurrence cubes</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/b-cubed-eu/dubicube" class="external-link">dubicube</a></span><span class="op">)</span>     <span class="co"># Analysis of data quality &amp; indicator uncertainty</span></span></code></pre></div>
<div class="section level3">
<h3 id="loading-and-processing-the-data">Loading and processing the data<a class="anchor" aria-label="anchor" href="#loading-and-processing-the-data"></a>
</h3>
<p>We load the bird cube data from the <strong>b3data</strong> data
package using <strong>frictionless</strong> (see also <a href="https://github.com/b-cubed-eu/b3data-scripts" class="external-link">here</a>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read data package</span></span>
<span><span class="va">b3data_package</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/frictionless/reference/read_package.html" class="external-link">read_package</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://zenodo.org/records/15211029/files/datapackage.json"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load bird cube data</span></span>
<span><span class="va">bird_cube_belgium</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/frictionless/reference/read_resource.html" class="external-link">read_resource</a></span><span class="op">(</span><span class="va">b3data_package</span>, <span class="st">"bird_cube_belgium_mgrs10"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bird_cube_belgium</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;    year mgrscode specieskey species          family     n mincoordinateuncerta…¹</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">473</span>958 Perdix perdix    Phasi…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">474</span>156 Coturnix coturn… Phasi…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">474</span>377 Fulica atra      Ralli…     5                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">475</span>443 Merops apiaster  Merop…     6                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">480</span>242 Vanellus vanell… Chara…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">2</span>000 31UDS65     2<span style="text-decoration: underline;">480</span>637 Accipiter nisus  Accip…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​mincoordinateuncertaintyinmeters</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: familycount &lt;dbl&gt;</span></span></span></code></pre></div>
<p>We process the cube with <strong>b3gbi</strong>. First, we select
3000 random rows to make the dataset smaller. We only keep grid cells
with more then 10 entries. This is to reduce the computation time for
this tutorial.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make dataset smaller</span></span>
<span><span class="va">rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bird_cube_belgium</span><span class="op">)</span>, <span class="fl">3000</span><span class="op">)</span></span>
<span><span class="va">bird_cube_belgium</span> <span class="op">&lt;-</span> <span class="va">bird_cube_belgium</span><span class="op">[</span><span class="va">rows</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_obs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, .by <span class="op">=</span> <span class="st">"mgrscode"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n_obs</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">n_obs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Process cube</span></span>
<span><span class="va">processed_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://b-cubed-eu.github.io/b3gbi/reference/process_cube.html" class="external-link">process_cube</a></span><span class="op">(</span></span>
<span>  <span class="va">bird_cube_belgium</span>,</span>
<span>  cols_occurrences <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">processed_cube</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Processed data cube for calculating biodiversity indicators</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Date Range: 2000 - 2024 </span></span>
<span><span class="co">#&gt; Single-resolution cube with cell size 10km ^2 </span></span>
<span><span class="co">#&gt; Number of cells: 134 </span></span>
<span><span class="co">#&gt; Grid reference system: mgrs </span></span>
<span><span class="co">#&gt; Coordinate range:</span></span>
<span><span class="co">#&gt;    xmin    xmax    ymin    ymax </span></span>
<span><span class="co">#&gt;  460000  690000 5610000 5700000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total number of observations: 91206 </span></span>
<span><span class="co">#&gt; Number of species represented: 316 </span></span>
<span><span class="co">#&gt; Number of families represented: 67 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Kingdoms represented: Data not present </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; First 10 rows of data (use n = to show more):</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,391 × 13</span></span></span>
<span><span class="co">#&gt;     year cellCode taxonKey scientificName    family   obs minCoordinateUncerta…¹</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>000 31UES44   2<span style="text-decoration: underline;">481</span>714 Tringa totanus    Scolo…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>000 31UFS05   2<span style="text-decoration: underline;">481</span>740 Calidris temminc… Scolo…     3                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>000 31UES43   2<span style="text-decoration: underline;">492</span>943 Sylvia communis   Sylvi…     8                   <span style="text-decoration: underline;">1</span>414</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>000 31UES44   5<span style="text-decoration: underline;">739</span>317 Phoenicurus phoe… Musci…    10                   <span style="text-decoration: underline;">1</span>000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>000 31UFS63   2<span style="text-decoration: underline;">481</span>700 Scolopax rustico… Scolo…     1                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>000 31UFS74   5<span style="text-decoration: underline;">845</span>582 Chloris chloris   Fring…     3                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>000 31UFS65   2<span style="text-decoration: underline;">492</span>960 Sylvia curruca    Sylvi…     7                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>000 31UFS07   2<span style="text-decoration: underline;">493</span>091 Phylloscopus col… Phyll…    19                   <span style="text-decoration: underline;">1</span>414</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>000 31UDS86   2<span style="text-decoration: underline;">489</span>214 Delichon urbicum  Hirun…     3                   <span style="text-decoration: underline;">3</span>536</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>000 31UES85   2<span style="text-decoration: underline;">473</span>958 Perdix perdix     Phasi…     9                   <span style="text-decoration: underline;">1</span>414</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,381 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​minCoordinateUncertaintyInMeters</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: familyCount &lt;dbl&gt;, xcoord &lt;dbl&gt;, ycoord &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   utmzone &lt;int&gt;, hemisphere &lt;chr&gt;, resolution &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="analysis-of-the-data">Analysis of the data<a class="anchor" aria-label="anchor" href="#analysis-of-the-data"></a>
</h3>
<p>Let’s say we are interested in the mean number of observations per
grid cell. We create a function to calculate this.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to calculate statistic of interest</span></span>
<span><span class="co"># Mean observations per grid cell</span></span>
<span><span class="va">mean_obs_grid</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>diversity_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>, .by <span class="op">=</span> <span class="st">"cellCode"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We get the following results:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span></span>
<span>  <span class="fu">mean_obs_grid</span><span class="op">(</span><span class="va">processed_cube</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   cellCode diversity_val</span></span>
<span><span class="co">#&gt; 1  31UES44      50.10526</span></span>
<span><span class="co">#&gt; 2  31UFS05      26.04762</span></span>
<span><span class="co">#&gt; 3  31UES43      35.42105</span></span>
<span><span class="co">#&gt; 4  31UFS63      16.93750</span></span>
<span><span class="co">#&gt; 5  31UFS74      24.94444</span></span>
<span><span class="co">#&gt; 6  31UFS65      26.17647</span></span></code></pre></div>
<p>On their own, these values don’t reveal how much uncertainty
surrounds them. To better understand their variability, we use
bootstrapping to estimate the distribution of the yearly means. From
this, we can calculate bootstrap confidence intervals.</p>
</div>
<div class="section level3">
<h3 id="bootstrapping">Bootstrapping<a class="anchor" aria-label="anchor" href="#bootstrapping"></a>
</h3>
<p>We use the <code><a href="../reference/bootstrap_cube.html">bootstrap_cube()</a></code> function to perform
bootstrapping (see also the <a href="https://b-cubed-eu.github.io/dubicube/articles/bootstrap-method-cubes.html">bootstrap
tutorial</a>). Since this indicator is calculated independently per
group (grid cell) we perform group-specific bootstrapping. For a
detailed discussion of when to use each approach, see <a href="https://b-cubed-eu.github.io/dubicube/articles/whole-cube-versus-group-specific-bootstrap.html">this
tutorial</a>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootstrap_results</span> <span class="op">&lt;-</span> <span class="va">processed_cube</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">processed_cube</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">cellCode</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">cube</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">bootstrap_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootstrap_cube.html">bootstrap_cube</a></span><span class="op">(</span></span>
<span>      data_cube <span class="op">=</span> <span class="va">cube</span>,</span>
<span>      fun <span class="op">=</span> <span class="va">mean_obs_grid</span>,</span>
<span>      grouping_var <span class="op">=</span> <span class="st">"cellCode"</span>,</span>
<span>      samples <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>      seed <span class="op">=</span> <span class="fl">123</span>,</span>
<span>      processed_cube <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bootstrap_results <span class="op">=</span> <span class="va">bootstrap_results</span>, data <span class="op">=</span> <span class="va">cube</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bootstrap_results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">bootstrap_results</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sample cellCode est_original rep_boot est_boot   se_boot bias_boot</span></span>
<span><span class="co">#&gt; 1      1  31UDS65     3.285714 4.357143 3.263714 0.9057524    -0.022</span></span>
<span><span class="co">#&gt; 2      2  31UDS65     3.285714 2.714286 3.263714 0.9057524    -0.022</span></span>
<span><span class="co">#&gt; 3      3  31UDS65     3.285714 3.571429 3.263714 0.9057524    -0.022</span></span>
<span><span class="co">#&gt; 4      4  31UDS65     3.285714 3.714286 3.263714 0.9057524    -0.022</span></span>
<span><span class="co">#&gt; 5      5  31UDS65     3.285714 3.214286 3.263714 0.9057524    -0.022</span></span>
<span><span class="co">#&gt; 6      6  31UDS65     3.285714 2.785714 3.263714 0.9057524    -0.022</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interval-calculation">Interval calculation<a class="anchor" aria-label="anchor" href="#interval-calculation"></a>
</h3>
<p>Now we can use the <code><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci()</a></code> function to
calculate confidence limits (see also the <a href="https://b-cubed-eu.github.io/dubicube/articles/bootstrap-method-cubes.html">bootstrap
confidence interval calculation tutorial</a>). We get a warning message
for BCa calculation because we are using a relatively small dataset.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ci_mean_obs_list</span> <span class="op">&lt;-</span> <span class="va">bootstrap_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">list</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/calculate_bootstrap_ci.html">calculate_bootstrap_ci</a></span><span class="op">(</span></span>
<span>      <span class="va">list</span><span class="op">$</span><span class="va">bootstrap_results</span>,</span>
<span>      grouping_var <span class="op">=</span> <span class="st">"cellCode"</span>,</span>
<span>      type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"perc"</span>, <span class="st">"bca"</span>, <span class="st">"norm"</span>, <span class="st">"basic"</span><span class="op">)</span>,</span>
<span>      conf <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>      data_cube <span class="op">=</span> <span class="va">list</span><span class="op">$</span><span class="va">data</span>, <span class="co"># Required for Bca</span></span>
<span>      fun <span class="op">=</span> <span class="va">mean_obs_grid</span>    <span class="co"># Required for Bca</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span><span class="co">#&gt; Warning in norm_inter(h(t), adj_alpha): Extreme order statistics used as</span></span>
<span><span class="co">#&gt; endpoints.</span></span>
<span></span>
<span><span class="co"># Make interval type factor</span></span>
<span><span class="va">ci_mean_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">ci_mean_obs_list</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    int_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>      <span class="va">int_type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"perc"</span>, <span class="st">"bca"</span>, <span class="st">"norm"</span>, <span class="st">"basic"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ci_mean_obs</span><span class="op">)</span></span>
<span><span class="co">#&gt;   cellCode est_original  est_boot   se_boot bias_boot int_type conf       ll</span></span>
<span><span class="co">#&gt; 1  31UDS65     3.285714  3.263714 0.9057524   -0.0220     perc 0.95 1.785714</span></span>
<span><span class="co">#&gt; 2  31UDS65     3.285714  3.263714 0.9057524   -0.0220      bca 0.95 2.000000</span></span>
<span><span class="co">#&gt; 3  31UDS65     3.285714  3.263714 0.9057524   -0.0220     norm 0.95 1.532472</span></span>
<span><span class="co">#&gt; 4  31UDS65     3.285714  3.263714 0.9057524   -0.0220    basic 0.95 1.357143</span></span>
<span><span class="co">#&gt; 5  31UDS66    10.333333 10.357533 6.1848863    0.0242     perc 0.95 2.400000</span></span>
<span><span class="co">#&gt; 6  31UDS66    10.333333 10.357533 6.1848863    0.0242      bca 0.95 3.066667</span></span>
<span><span class="co">#&gt;          ul</span></span>
<span><span class="co">#&gt; 1  5.214286</span></span>
<span><span class="co">#&gt; 2  6.434174</span></span>
<span><span class="co">#&gt; 3  5.082956</span></span>
<span><span class="co">#&gt; 4  4.785714</span></span>
<span><span class="co">#&gt; 5 24.000000</span></span>
<span><span class="co">#&gt; 6 36.095861</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="visualising-uncertainty-in-spatial-trends">Visualising uncertainty in spatial trends<a class="anchor" aria-label="anchor" href="#visualising-uncertainty-in-spatial-trends"></a>
</h2>
<p>We can visualise the estimate and confidence levels in separate
figures.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read MGRS grid from repository</span></span>
<span><span class="va">mgrs10_belgium</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://zenodo.org/records/15211029/files/mgrs10_refgrid_belgium.gpkg"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get BCa intervals</span></span>
<span><span class="va">bca_mean_obs</span> <span class="op">&lt;-</span> <span class="va">ci_mean_obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">int_type</span> <span class="op">==</span> <span class="st">"bca"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add MGRS grid</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">mgrs10_belgium</span>, by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">cellCode</span> <span class="op">==</span> <span class="va">mgrscode</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span>sf_column_name <span class="op">=</span> <span class="st">"geom"</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">mgrs10_belgium</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualise estimates</span></span>
<span><span class="va">bca_mean_obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Visualise result</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mgrs10_belgium</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">est_original</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Settings</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Estimate"</span>, fill <span class="op">=</span> <span class="st">"Legend"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualising-spatial-trends_files/figure-html/unnamed-chunk-14-1.png" alt="Estimates for mean number of occurrences per grid cell." width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualise lower CI's</span></span>
<span><span class="va">bca_mean_obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Visualise result</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mgrs10_belgium</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">ll</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Settings</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Lower confidence limit"</span>, fill <span class="op">=</span> <span class="st">"Legend"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualising-spatial-trends_files/figure-html/unnamed-chunk-15-1.png" alt="Lower CI's for mean number of occurrences per grid cell." width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualise upper CI's</span></span>
<span><span class="va">bca_mean_obs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Visualise result</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mgrs10_belgium</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">ul</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Settings</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Upper confidence limit"</span>, fill <span class="op">=</span> <span class="st">"Legend"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualising-spatial-trends_files/figure-html/unnamed-chunk-16-1.png" alt="Upper CI's for mean number of occurrences per grid cell." width="700"></p>
<p>If we want to visualise estimates and uncertainty in a single figure,
we need a good uncertainty measure. One straightforward option is the
width of the confidence interval (CI):</p>
<p><span class="math display">\[
\text{CI width} = \text{upper limit} - \text{lower limit}
\]</span></p>
<p>This directly reflects the uncertainty — wider intervals indicate
greater uncertainty.</p>
<p>To allow for comparisons across spatial units with different
magnitudes, we may prefer a relative measure of uncertainty such as the
relative CI half-width, calculated as:</p>
<p><span class="math display">\[
\frac{\text{CI width}}{2 \times \text{estimate}}
\]</span></p>
<p>This expresses the margin of error as a proportion of the estimate,
which is easier to interpret. For example, a value of 0.1 implies ±10%
uncertainty around the point estimate (assuming symmetric
intervals).</p>
<p>Alternatively, we can use the bootstrap standard error as a measure
of uncertainty. Similar to CI width, it can be expressed in absolute or
relative terms (e.g., standard error divided by the estimate) depending
on whether you want to visualise raw or normalized uncertainty.</p>
<table class="table">
<colgroup>
<col width="24%">
<col width="30%">
<col width="45%">
</colgroup>
<thead><tr class="header">
<th>Measure</th>
<th>Formula</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>CI width</td>
<td><code>ul - ll</code></td>
<td>Absolute uncertainty</td>
</tr>
<tr class="even">
<td>Relative CI width</td>
<td><code>(ul - ll) / estimate</code></td>
<td>Total CI width scaled by estimate</td>
</tr>
<tr class="odd">
<td>Relative CI half-width</td>
<td><code>(ul - ll) / (2 × estimate)</code></td>
<td>Margin of error relative to estimate</td>
</tr>
<tr class="even">
<td>Bootstrap SE</td>
<td><code>sd(bootstrap replicates)</code></td>
<td>Standard deviation of bootstrap samples</td>
</tr>
<tr class="odd">
<td>Relative bootstrap SE</td>
<td><code>sd(...) / estimate</code></td>
<td>Standard error relative to estimate</td>
</tr>
</tbody>
</table>
<p>For visualising both the estimate and uncertainty in a single map, we
can use circles within the grid cells that vary in transparency (best
w.r.t. user performance ~ accuracy, speed), or in blurriness (best
w.r.t. user intuitiveness) (Kinkeldey et al., 2014; MacEachren et al.,
2005, 2012).</p>
<div class="section level3">
<h3 id="transparency">Transparency<a class="anchor" aria-label="anchor" href="#transparency"></a>
</h3>
<p>Let’s visualise the relative half-width where we use a larger
transparency for larger uncertainty. Transparency can be scaled using
the <code><a href="https://ggplot2.tidyverse.org/reference/scale_alpha.html" class="external-link">scale_alpha()</a></code> function from
<strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate center points</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="va">bca_mean_obs</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">geom</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>         y <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">geom</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>         <span class="co"># Calculate uncertainty measure</span></span>
<span>         uncertainty <span class="op">=</span> <span class="op">(</span><span class="va">ul</span> <span class="op">-</span> <span class="va">ll</span><span class="op">)</span> <span class="op">/</span>  <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">est_original</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Visualise</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mgrs10_belgium</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, colour <span class="op">=</span> <span class="va">est_original</span>, alpha <span class="op">=</span> <span class="va">uncertainty</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Settings</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_alpha.html" class="external-link">scale_alpha</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>    <span class="co"># Scale accordingly</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"Estimate"</span>, alpha <span class="op">=</span> <span class="st">"Uncertainty"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualising-spatial-trends_files/figure-html/unnamed-chunk-17-1.png" alt="Spatial uncertainty using transparency." width="700"></p>
<p>To make the visualisation even more clear, we can also vary size
based on the uncertainty measure. Size can be scaled using the
<code><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size()</a></code> function from <strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate center points</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="va">bca_mean_obs</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">geom</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>         y <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">geom</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>         <span class="co"># Calculate uncertainty measure</span></span>
<span>         uncertainty <span class="op">=</span> <span class="op">(</span><span class="va">ul</span> <span class="op">-</span> <span class="va">ll</span><span class="op">)</span> <span class="op">/</span>  <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">est_original</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Visualise</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mgrs10_belgium</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, colour <span class="op">=</span> <span class="va">est_original</span>, alpha <span class="op">=</span> <span class="va">uncertainty</span>,</span>
<span>        size <span class="op">=</span> <span class="va">uncertainty</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Settings</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_alpha.html" class="external-link">scale_alpha</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>    <span class="co"># Scale accordingly</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>       <span class="co"># Scale accordingly</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"Estimate"</span>, alpha <span class="op">=</span> <span class="st">"Uncertainty"</span>, size <span class="op">=</span> <span class="st">"Uncertainty"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualising-spatial-trends_files/figure-html/unnamed-chunk-18-1.png" alt="Spatial uncertainty using transparency and size." width="700"></p>
</div>
<div class="section level3">
<h3 id="blurriness">Blurriness<a class="anchor" aria-label="anchor" href="#blurriness"></a>
</h3>
<p>Unlike transparency or point size, blurriness is not natively
supported in <strong>ggplot2</strong>. Therefore, we present a custom
figure using a hard-coded example that illustrates the difference
between blurriness and transparency as visual indicators of spatial
uncertainty.</p>
<p><img src="figures/blur-spatial-uncertainty.png" alt="Compare spatial blur and transparency." width="100%"></p>
<p>The figure was created using the R packages <strong>ggplot2</strong>,
<strong>dplyr</strong>, <strong>sf</strong>, and <a href="https://github.com/coolbutuseless/ggblur" class="external-link"><strong>ggblur</strong></a>.
The <strong>ggblur</strong> package provides a useful starting point for
implementing blur effects in ggplot2 plots, but it does not fully meet
our requirements. In <strong>ggblur</strong>, blurriness is simulated by
plotting the original point together with a series of increasingly
larger and more transparent copies behind it. This creates a visual
“halo” effect that mimics blur. However, <strong>ggblur</strong>
increases both the size and transparency of the blurred copies
simultaneously, whereas we require more flexibility: the maximum size of
the blur should be able to remain constant or even decrease, while the
perceived blur increases. To achieve this more controlled and flexible
behaviour, we would need to develop a new, dedicated R package that
allows finer control over the relationship between size and blur.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<!-- spell-check: ignore:start -->
<p>Kinkeldey, C., MacEachren, A. M., &amp; Schiewe, J. (2014). How to
Assess Visual Communication of Uncertainty? A Systematic Review of
Geospatial Uncertainty Visualisation User Studies. <em>The Cartographic
Journal, 51</em>(4), 372–386. <a href="https://doi.org/10.1179/1743277414Y.0000000099" class="external-link uri">https://doi.org/10.1179/1743277414Y.0000000099</a></p>
<p>MacEachren, A. M., Robinson, A., Hopper, S., Gardner, S., Murray, R.,
Gahegan, M., &amp; Hetzler, E. (2005). Visualizing Geospatial
Information Uncertainty: What We Know and What We Need to Know.
<em>Cartography and Geographic Information Science, 32</em>(3), 139–160.
<a href="https://doi.org/10.1559/1523040054738936" class="external-link uri">https://doi.org/10.1559/1523040054738936</a></p>
<p>MacEachren, A. M., Roth, R. E., O’Brien, J., Li, B., Swingley, D.,
&amp; Gahegan, M. (2012). Visual Semiotics &amp; Uncertainty
Visualization: An Empirical Study. <em>IEEE Transactions on
Visualization and Computer Graphics, 18</em>(12), 2496–2505. <a href="https://doi.org/10.1109/TVCG.2012.279" class="external-link uri">https://doi.org/10.1109/TVCG.2012.279</a>
<!-- spell-check: ignore:end --></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ward Langeraert, Toon Van Daele, European Union.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
